   1               		.file	"spi.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.text
   8               	.Ltext0:
   9               		.cfi_sections	.debug_frame
  10               		.file 0 "/home/files/osdev/platform/avr" "spi/spi.c"
  11               	.global	spi_init
  13               	spi_init:
  14               	.LFB3:
  15               		.file 1 "spi/spi.c"
   1:spi/spi.c     **** /**
   2:spi/spi.c     ****  * @file    spi.c
   3:spi/spi.c     ****  * @author  Anton Tchekov
   4:spi/spi.c     ****  * @version 0.1
   5:spi/spi.c     ****  * @date    16.05.2023
   6:spi/spi.c     ****  */
   7:spi/spi.c     **** 
   8:spi/spi.c     **** #include <spi.h>
   9:spi/spi.c     **** #include <logger.h>
  10:spi/spi.c     **** #include <avr/pgmspace.h>
  11:spi/spi.c     **** 
  12:spi/spi.c     **** void spi_init(void)
  13:spi/spi.c     **** {
  16               		.loc 1 13 1 view -0
  17               		.cfi_startproc
  18               	/* prologue: function */
  19               	/* frame size = 0 */
  20               	/* stack size = 0 */
  21               	.L__stack_usage = 0
  14:spi/spi.c     **** 	SPI_DIR |= (1 << SPI_MOSI) | (1 << SPI_SCK);
  22               		.loc 1 14 2 view .LVU1
  23 0000 84B1      		in r24,0x4
  24               		.loc 1 14 10 is_stmt 0 view .LVU2
  25 0002 8862      		ori r24,lo8(40)
  26 0004 84B9      		out 0x4,r24
  15:spi/spi.c     **** 	SPCR = (1 << SPE) | (1 << MSTR);
  27               		.loc 1 15 2 is_stmt 1 view .LVU3
  28               		.loc 1 15 7 is_stmt 0 view .LVU4
  29 0006 80E5      		ldi r24,lo8(80)
  30 0008 8CBD      		out 0x2c,r24
  16:spi/spi.c     **** 	log_boot_P(PSTR("SPI initialized"));
  31               		.loc 1 16 2 is_stmt 1 view .LVU5
  32               	.LBB2:
  33               		.loc 1 16 13 view .LVU6
  34               		.loc 1 16 13 view .LVU7
  35               	.LBE2:
  36               		.loc 1 16 2 is_stmt 0 view .LVU8
  37 000a 80E0      		ldi r24,lo8(__c.1)
  38 000c 90E0      		ldi r25,hi8(__c.1)
  39 000e 9F93      		push r25
  40               		.cfi_def_cfa_offset 3
  41 0010 8F93      		push r24
  42               		.cfi_def_cfa_offset 4
  43 0012 0E94 0000 		call log_boot_P
  44               	.LVL0:
  17:spi/spi.c     **** }
  45               		.loc 1 17 1 view .LVU9
  46 0016 0F90      		pop __tmp_reg__
  47 0018 0F90      		pop __tmp_reg__
  48               		.cfi_def_cfa_offset 2
  49               	/* epilogue start */
  50 001a 0895      		ret
  51               		.cfi_endproc
  52               	.LFE3:
  54               	.global	spi_xchg
  56               	spi_xchg:
  57               	.LVL1:
  58               	.LFB4:
  18:spi/spi.c     **** 
  19:spi/spi.c     **** u8 spi_xchg(u8 byte)
  20:spi/spi.c     **** {
  59               		.loc 1 20 1 is_stmt 1 view -0
  60               		.cfi_startproc
  61               	/* prologue: function */
  62               	/* frame size = 0 */
  63               	/* stack size = 0 */
  64               	.L__stack_usage = 0
  21:spi/spi.c     **** 	u16 cnt = 0;
  65               		.loc 1 21 2 view .LVU11
  22:spi/spi.c     **** 
  23:spi/spi.c     **** 	SPDR = byte;
  66               		.loc 1 23 2 view .LVU12
  67               		.loc 1 23 7 is_stmt 0 view .LVU13
  68 001c 8EBD      		out 0x2e,r24
  24:spi/spi.c     **** 	while(!(SPSR & (1 << SPIF)))
  69               		.loc 1 24 2 is_stmt 1 view .LVU14
  70               	.LVL2:
  71               	.L3:
  20:spi/spi.c     **** 	u16 cnt = 0;
  72               		.loc 1 20 1 is_stmt 0 view .LVU15
  73 001e 80E0      		ldi r24,0
  74 0020 90E0      		ldi r25,0
  75               	.L4:
  76               	.LVL3:
  77               		.loc 1 24 8 is_stmt 1 view .LVU16
  78 0022 0DB4      		in __tmp_reg__,0x2d
  79 0024 07FE      		sbrs __tmp_reg__,7
  80 0026 00C0      		rjmp .L5
  25:spi/spi.c     **** 	{
  26:spi/spi.c     **** 		if(cnt++ == 0xFFFF)
  27:spi/spi.c     **** 		{
  28:spi/spi.c     **** 			panic(PSTR("SPI timeout"));
  29:spi/spi.c     **** 		}
  30:spi/spi.c     **** 	}
  31:spi/spi.c     **** 	return SPDR;
  81               		.loc 1 31 2 view .LVU17
  82               		.loc 1 31 9 is_stmt 0 view .LVU18
  83 0028 8EB5      		in r24,0x2e
  84               	.LVL4:
  85               	/* epilogue start */
  32:spi/spi.c     **** }
  86               		.loc 1 32 1 view .LVU19
  87 002a 0895      		ret
  88               	.LVL5:
  89               	.L5:
  26:spi/spi.c     **** 		{
  90               		.loc 1 26 3 is_stmt 1 view .LVU20
  26:spi/spi.c     **** 		{
  91               		.loc 1 26 5 is_stmt 0 view .LVU21
  92 002c 0197      		sbiw r24,1
  93               	.LVL6:
  26:spi/spi.c     **** 		{
  94               		.loc 1 26 5 view .LVU22
  95 002e 0097      		sbiw r24,0
  96 0030 01F4      		brne .L4
  28:spi/spi.c     **** 		}
  97               		.loc 1 28 4 is_stmt 1 view .LVU23
  98               	.LBB3:
  28:spi/spi.c     **** 		}
  99               		.loc 1 28 10 view .LVU24
  28:spi/spi.c     **** 		}
 100               		.loc 1 28 10 view .LVU25
 101               	.LBE3:
  28:spi/spi.c     **** 		}
 102               		.loc 1 28 4 is_stmt 0 view .LVU26
 103 0032 80E0      		ldi r24,lo8(__c.0)
 104 0034 90E0      		ldi r25,hi8(__c.0)
 105               	.LVL7:
  28:spi/spi.c     **** 		}
 106               		.loc 1 28 4 view .LVU27
 107 0036 9F93      		push r25
 108               		.cfi_def_cfa_offset 3
 109 0038 8F93      		push r24
 110               		.cfi_def_cfa_offset 4
 111 003a 0E94 0000 		call panic
 112               	.LVL8:
 113 003e 0F90      		pop __tmp_reg__
 114 0040 0F90      		pop __tmp_reg__
 115               		.cfi_def_cfa_offset 2
 116 0042 00C0      		rjmp .L3
 117               		.cfi_endproc
 118               	.LFE4:
 120               		.section	.progmem.data,"a",@progbits
 123               	__c.0:
 124 0000 5350 4920 		.string	"SPI timeout"
 124      7469 6D65 
 124      6F75 7400 
 127               	__c.1:
 128 000c 5350 4920 		.string	"SPI initialized"
 128      696E 6974 
 128      6961 6C69 
 128      7A65 6400 
 129               		.text
 130               	.Letext0:
 131               		.file 2 "/usr/lib/gcc/avr/12.2.0/include/stdint-gcc.h"
 132               		.file 3 "../../types/types.h"
 133               		.file 4 "logger/logger.h"
DEFINED SYMBOLS
                            *ABS*:00000000 spi.c
     /tmp/ccRMuwwT.s:2      *ABS*:0000003e __SP_H__
     /tmp/ccRMuwwT.s:3      *ABS*:0000003d __SP_L__
     /tmp/ccRMuwwT.s:4      *ABS*:0000003f __SREG__
     /tmp/ccRMuwwT.s:5      *ABS*:00000000 __tmp_reg__
     /tmp/ccRMuwwT.s:6      *ABS*:00000001 __zero_reg__
     /tmp/ccRMuwwT.s:13     .text:00000000 spi_init
     /tmp/ccRMuwwT.s:16     .text:00000000 .Loc.0
     /tmp/ccRMuwwT.s:17     .text:00000000 L0
     /tmp/ccRMuwwT.s:22     .text:00000000 .Loc.1
     /tmp/ccRMuwwT.s:24     .text:00000002 .Loc.2
     /tmp/ccRMuwwT.s:27     .text:00000006 .Loc.3
     /tmp/ccRMuwwT.s:28     .text:00000006 .Loc.4
     /tmp/ccRMuwwT.s:31     .text:0000000a .Loc.5
     /tmp/ccRMuwwT.s:33     .text:0000000a .Loc.6
     /tmp/ccRMuwwT.s:34     .text:0000000a .Loc.7
     /tmp/ccRMuwwT.s:36     .text:0000000a .Loc.8
     /tmp/ccRMuwwT.s:127    .progmem.data:0000000c __c.1
     /tmp/ccRMuwwT.s:45     .text:00000016 .Loc.9
     /tmp/ccRMuwwT.s:51     .text:0000001c L0
     /tmp/ccRMuwwT.s:56     .text:0000001c spi_xchg
     /tmp/ccRMuwwT.s:59     .text:0000001c .Loc.10
     /tmp/ccRMuwwT.s:60     .text:0000001c L0
     /tmp/ccRMuwwT.s:65     .text:0000001c .Loc.11
     /tmp/ccRMuwwT.s:66     .text:0000001c .Loc.12
     /tmp/ccRMuwwT.s:67     .text:0000001c .Loc.13
     /tmp/ccRMuwwT.s:69     .text:0000001e .Loc.14
     /tmp/ccRMuwwT.s:72     .text:0000001e .Loc.15
     /tmp/ccRMuwwT.s:77     .text:00000022 .Loc.16
     /tmp/ccRMuwwT.s:81     .text:00000028 .Loc.17
     /tmp/ccRMuwwT.s:82     .text:00000028 .Loc.18
     /tmp/ccRMuwwT.s:86     .text:0000002a .Loc.19
     /tmp/ccRMuwwT.s:90     .text:0000002c .Loc.20
     /tmp/ccRMuwwT.s:91     .text:0000002c .Loc.21
     /tmp/ccRMuwwT.s:94     .text:0000002e .Loc.22
     /tmp/ccRMuwwT.s:97     .text:00000032 .Loc.23
     /tmp/ccRMuwwT.s:99     .text:00000032 .Loc.24
     /tmp/ccRMuwwT.s:100    .text:00000032 .Loc.25
     /tmp/ccRMuwwT.s:102    .text:00000032 .Loc.26
     /tmp/ccRMuwwT.s:123    .progmem.data:00000000 __c.0
     /tmp/ccRMuwwT.s:106    .text:00000036 .Loc.27
     /tmp/ccRMuwwT.s:117    .text:00000044 L0
     /tmp/ccRMuwwT.s:134    .text:00000044 L0
                     .debug_frame:00000000 L0
     /tmp/ccRMuwwT.s:89     .text:0000002c .L5
     /tmp/ccRMuwwT.s:75     .text:00000022 .L4
     /tmp/ccRMuwwT.s:71     .text:0000001e .L3
     /tmp/ccRMuwwT.s:325    .debug_abbrev:00000000 .Ldebug_abbrev0
     /tmp/ccRMuwwT.s:8      .text:00000000 .Ltext0
     /tmp/ccRMuwwT.s:130    .text:00000044 .Letext0
     /tmp/ccRMuwwT.s:695    .debug_line:00000000 .Ldebug_line0
     /tmp/ccRMuwwT.s:58     .text:0000001c .LFB4
     /tmp/ccRMuwwT.s:118    .text:00000044 .LFE4
     /tmp/ccRMuwwT.s:614    .debug_loclists:00000010 .LLST0
     /tmp/ccRMuwwT.s:609    .debug_loclists:0000000c .LVUS0
     /tmp/ccRMuwwT.s:640    .debug_loclists:00000028 .LLST1
     /tmp/ccRMuwwT.s:629    .debug_loclists:0000001e .LVUS1
     /tmp/ccRMuwwT.s:98     .text:00000032 .LBB3
     /tmp/ccRMuwwT.s:101    .text:00000032 .LBE3
     /tmp/ccRMuwwT.s:112    .text:0000003e .LVL8
     /tmp/ccRMuwwT.s:14     .text:00000000 .LFB3
     /tmp/ccRMuwwT.s:52     .text:0000001c .LFE3
     /tmp/ccRMuwwT.s:32     .text:0000000a .LBB2
     /tmp/ccRMuwwT.s:35     .text:0000000a .LBE2
     /tmp/ccRMuwwT.s:44     .text:00000016 .LVL0
     /tmp/ccRMuwwT.s:135    .debug_info:00000000 .Ldebug_info0

UNDEFINED SYMBOLS
log_boot_P
panic
