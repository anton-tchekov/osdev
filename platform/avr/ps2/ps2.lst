   1               		.file	"ps2.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.text
   8               	.Ltext0:
   9               		.cfi_sections	.debug_frame
  10               		.file 0 "/home/files/osdev/platform/avr" "ps2/ps2.c"
  11               	.global	ps2_init
  13               	ps2_init:
  14               	.LFB3:
  15               		.file 1 "ps2/ps2.c"
   1:ps2/ps2.c     **** /**
   2:ps2/ps2.c     ****  * @file    ps2.c
   3:ps2/ps2.c     ****  * @author  Haron Nazari, Anton Tchekov
   4:ps2/ps2.c     ****  * @version 0.1
   5:ps2/ps2.c     ****  * @date    16.05.2023
   6:ps2/ps2.c     ****  */
   7:ps2/ps2.c     **** 
   8:ps2/ps2.c     **** #include <ps2.h>
   9:ps2/ps2.c     **** #include <logger.h>
  10:ps2/ps2.c     **** #include <gpio.h>
  11:ps2/ps2.c     **** #include <avr/pgmspace.h>
  12:ps2/ps2.c     **** 
  13:ps2/ps2.c     **** /** The byte that is currently being received */
  14:ps2/ps2.c     **** static u8 _byte;
  15:ps2/ps2.c     **** 
  16:ps2/ps2.c     **** /**
  17:ps2/ps2.c     ****  * The number of the current bit:
  18:ps2/ps2.c     ****  *
  19:ps2/ps2.c     ****  *   0: Start bit
  20:ps2/ps2.c     ****  * 1-8: Data bit
  21:ps2/ps2.c     ****  *   9: Parity bit
  22:ps2/ps2.c     ****  *  10: Stop bit
  23:ps2/ps2.c     ****  */
  24:ps2/ps2.c     **** static u8 _bit;
  25:ps2/ps2.c     **** 
  26:ps2/ps2.c     **** void ps2_init(void)
  27:ps2/ps2.c     **** {
  16               		.loc 1 27 1 view -0
  17               		.cfi_startproc
  18               	/* prologue: function */
  19               	/* frame size = 0 */
  20               	/* stack size = 0 */
  21               	.L__stack_usage = 0
  28:ps2/ps2.c     **** 	/* Enable external interrupt 0 (PORTB2) */
  29:ps2/ps2.c     **** 	EIMSK |= (1 << PS2_EXT_INTERRUPT);
  22               		.loc 1 29 2 view .LVU1
  23               		.loc 1 29 8 is_stmt 0 view .LVU2
  24 0000 E89A      		sbi 0x1d,0
  30:ps2/ps2.c     **** 
  31:ps2/ps2.c     **** 	/* Trigger interrupt on falling edge */
  32:ps2/ps2.c     **** 	EICRA |= (1 << ISC01);
  25               		.loc 1 32 2 is_stmt 1 view .LVU3
  26 0002 E9E6      		ldi r30,lo8(105)
  27 0004 F0E0      		ldi r31,0
  28 0006 8081      		ld r24,Z
  29               		.loc 1 32 8 is_stmt 0 view .LVU4
  30 0008 8260      		ori r24,lo8(2)
  31 000a 8083      		st Z,r24
  33:ps2/ps2.c     **** 
  34:ps2/ps2.c     **** 	log_boot_P(LOG_INIT, PSTR("PS/2 keyboard initialized"));
  32               		.loc 1 34 2 is_stmt 1 view .LVU5
  33               	.LBB4:
  34               		.loc 1 34 23 view .LVU6
  35               		.loc 1 34 23 view .LVU7
  36               	.LBE4:
  37               		.loc 1 34 2 is_stmt 0 view .LVU8
  38 000c 80E0      		ldi r24,lo8(__c.0)
  39 000e 90E0      		ldi r25,hi8(__c.0)
  40 0010 9F93      		push r25
  41               		.cfi_def_cfa_offset 3
  42 0012 8F93      		push r24
  43               		.cfi_def_cfa_offset 4
  44 0014 1F92      		push __zero_reg__
  45               		.cfi_def_cfa_offset 5
  46 0016 0E94 0000 		call log_boot_P
  47               	.LVL0:
  35:ps2/ps2.c     **** }
  48               		.loc 1 35 1 view .LVU9
  49 001a 0F90      		pop __tmp_reg__
  50 001c 0F90      		pop __tmp_reg__
  51 001e 0F90      		pop __tmp_reg__
  52               		.cfi_def_cfa_offset 2
  53               	/* epilogue start */
  54 0020 0895      		ret
  55               		.cfi_endproc
  56               	.LFE3:
  58               	.global	__vector_1
  60               	__vector_1:
  61               	.LFB6:
  36:ps2/ps2.c     **** 
  37:ps2/ps2.c     **** /**
  38:ps2/ps2.c     ****  * @brief Get the PS/2 data line state
  39:ps2/ps2.c     ****  *
  40:ps2/ps2.c     ****  * @return 0 if LOW, non-zero if HIGH
  41:ps2/ps2.c     ****  */
  42:ps2/ps2.c     **** static inline u8 _ps2_data_read(void)
  43:ps2/ps2.c     **** {
  44:ps2/ps2.c     **** 	/* Read keyboard data pin */
  45:ps2/ps2.c     **** 	return PS2_DATA_PORT_IN & (1 << PS2_DATA_PIN);
  46:ps2/ps2.c     **** }
  47:ps2/ps2.c     **** 
  48:ps2/ps2.c     **** /**
  49:ps2/ps2.c     ****  * @brief Called when a falling edge is detected on the PS/2 clock pin
  50:ps2/ps2.c     ****  */
  51:ps2/ps2.c     **** static inline void _ps2_clock_falling_edge(void)
  52:ps2/ps2.c     **** {
  53:ps2/ps2.c     **** 	if(_bit == 0)
  54:ps2/ps2.c     **** 	{
  55:ps2/ps2.c     **** 		/* Start bit, reset byte */
  56:ps2/ps2.c     **** 		_byte = 0;
  57:ps2/ps2.c     **** 	}
  58:ps2/ps2.c     **** 	else if(_bit >= 1 && _bit <= 8)
  59:ps2/ps2.c     **** 	{
  60:ps2/ps2.c     **** 		/* Data bit */
  61:ps2/ps2.c     **** 		if(_ps2_data_read())
  62:ps2/ps2.c     **** 		{
  63:ps2/ps2.c     **** 			/* Set bit */
  64:ps2/ps2.c     **** 			_byte |= (1 << (_bit - 1));
  65:ps2/ps2.c     **** 		}
  66:ps2/ps2.c     **** 	}
  67:ps2/ps2.c     **** 	else if(_bit == 9)
  68:ps2/ps2.c     **** 	{
  69:ps2/ps2.c     **** 		/* Ignore parity bit */
  70:ps2/ps2.c     **** 		/* TODO: Check parity bit */
  71:ps2/ps2.c     **** 		ps2_event(_byte);
  72:ps2/ps2.c     **** 	}
  73:ps2/ps2.c     **** 	else if(_bit == 10)
  74:ps2/ps2.c     **** 	{
  75:ps2/ps2.c     **** 		/* Stop bit, reset bit counter */
  76:ps2/ps2.c     **** 		_bit = 0;
  77:ps2/ps2.c     **** 
  78:ps2/ps2.c     **** 		/* Return immediately so it stays 0 */
  79:ps2/ps2.c     **** 		return;
  80:ps2/ps2.c     **** 	}
  81:ps2/ps2.c     **** 
  82:ps2/ps2.c     **** 	++_bit;
  83:ps2/ps2.c     **** }
  84:ps2/ps2.c     **** 
  85:ps2/ps2.c     **** /** External interrupt */
  86:ps2/ps2.c     **** ISR(INT0_vect)
  87:ps2/ps2.c     **** {
  62               		.loc 1 87 1 is_stmt 1 view -0
  63               		.cfi_startproc
  64 0022 1F92      		push r1
  65               		.cfi_def_cfa_offset 3
  66               		.cfi_offset 1, -2
  67 0024 0F92      		push r0
  68               		.cfi_def_cfa_offset 4
  69               		.cfi_offset 0, -3
  70 0026 0FB6      		in r0,__SREG__
  71 0028 0F92      		push r0
  72 002a 1124      		clr __zero_reg__
  73 002c 2F93      		push r18
  74               		.cfi_def_cfa_offset 5
  75               		.cfi_offset 18, -4
  76 002e 3F93      		push r19
  77               		.cfi_def_cfa_offset 6
  78               		.cfi_offset 19, -5
  79 0030 4F93      		push r20
  80               		.cfi_def_cfa_offset 7
  81               		.cfi_offset 20, -6
  82 0032 5F93      		push r21
  83               		.cfi_def_cfa_offset 8
  84               		.cfi_offset 21, -7
  85 0034 6F93      		push r22
  86               		.cfi_def_cfa_offset 9
  87               		.cfi_offset 22, -8
  88 0036 7F93      		push r23
  89               		.cfi_def_cfa_offset 10
  90               		.cfi_offset 23, -9
  91 0038 8F93      		push r24
  92               		.cfi_def_cfa_offset 11
  93               		.cfi_offset 24, -10
  94 003a 9F93      		push r25
  95               		.cfi_def_cfa_offset 12
  96               		.cfi_offset 25, -11
  97 003c AF93      		push r26
  98               		.cfi_def_cfa_offset 13
  99               		.cfi_offset 26, -12
 100 003e BF93      		push r27
 101               		.cfi_def_cfa_offset 14
 102               		.cfi_offset 27, -13
 103 0040 EF93      		push r30
 104               		.cfi_def_cfa_offset 15
 105               		.cfi_offset 30, -14
 106 0042 FF93      		push r31
 107               		.cfi_def_cfa_offset 16
 108               		.cfi_offset 31, -15
 109               	/* prologue: Signal */
 110               	/* frame size = 0 */
 111               	/* stack size = 15 */
 112               	.L__stack_usage = 15
  88:ps2/ps2.c     **** 	_ps2_clock_falling_edge();
 113               		.loc 1 88 2 view .LVU11
 114               	.LBB9:
 115               	.LBI9:
  51:ps2/ps2.c     **** {
 116               		.loc 1 51 20 view .LVU12
 117               	.LBB10:
  53:ps2/ps2.c     **** 	{
 118               		.loc 1 53 2 view .LVU13
  53:ps2/ps2.c     **** 	{
 119               		.loc 1 53 10 is_stmt 0 view .LVU14
 120 0044 8091 0000 		lds r24,_bit
  53:ps2/ps2.c     **** 	{
 121               		.loc 1 53 4 view .LVU15
 122 0048 8111      		cpse r24,__zero_reg__
 123 004a 00C0      		rjmp .L3
  56:ps2/ps2.c     **** 	}
 124               		.loc 1 56 3 is_stmt 1 view .LVU16
  56:ps2/ps2.c     **** 	}
 125               		.loc 1 56 9 is_stmt 0 view .LVU17
 126 004c 1092 0000 		sts _byte,__zero_reg__
 127               	.L4:
  82:ps2/ps2.c     **** }
 128               		.loc 1 82 2 is_stmt 1 view .LVU18
 129 0050 8091 0000 		lds r24,_bit
 130 0054 8F5F      		subi r24,lo8(-(1))
 131               	.L7:
  76:ps2/ps2.c     **** 
 132               		.loc 1 76 8 is_stmt 0 view .LVU19
 133 0056 8093 0000 		sts _bit,r24
 134               	/* epilogue start */
 135               	.LBE10:
 136               	.LBE9:
  89:ps2/ps2.c     **** }
 137               		.loc 1 89 1 view .LVU20
 138 005a FF91      		pop r31
 139 005c EF91      		pop r30
 140 005e BF91      		pop r27
 141 0060 AF91      		pop r26
 142 0062 9F91      		pop r25
 143 0064 8F91      		pop r24
 144 0066 7F91      		pop r23
 145 0068 6F91      		pop r22
 146 006a 5F91      		pop r21
 147 006c 4F91      		pop r20
 148 006e 3F91      		pop r19
 149 0070 2F91      		pop r18
 150 0072 0F90      		pop r0
 151 0074 0FBE      		out __SREG__,r0
 152 0076 0F90      		pop r0
 153 0078 1F90      		pop r1
 154 007a 1895      		reti
 155               	.L3:
 156               	.LBB14:
 157               	.LBB13:
  58:ps2/ps2.c     **** 	{
 158               		.loc 1 58 7 is_stmt 1 view .LVU21
  58:ps2/ps2.c     **** 	{
 159               		.loc 1 58 20 is_stmt 0 view .LVU22
 160 007c 9FEF      		ldi r25,lo8(-1)
 161 007e 980F      		add r25,r24
  58:ps2/ps2.c     **** 	{
 162               		.loc 1 58 9 view .LVU23
 163 0080 9830      		cpi r25,lo8(8)
 164 0082 00F4      		brsh .L5
  61:ps2/ps2.c     **** 		{
 165               		.loc 1 61 3 is_stmt 1 view .LVU24
 166               	.LBB11:
 167               	.LBI11:
  42:ps2/ps2.c     **** {
 168               		.loc 1 42 18 view .LVU25
 169               	.LBB12:
  45:ps2/ps2.c     **** }
 170               		.loc 1 45 2 view .LVU26
 171               	.LBE12:
 172               	.LBE11:
  61:ps2/ps2.c     **** 		{
 173               		.loc 1 61 5 is_stmt 0 view .LVU27
 174 0084 1B9B      		sbis 0x3,3
 175 0086 00C0      		rjmp .L4
  64:ps2/ps2.c     **** 		}
 176               		.loc 1 64 4 is_stmt 1 view .LVU28
  64:ps2/ps2.c     **** 		}
 177               		.loc 1 64 25 is_stmt 0 view .LVU29
 178 0088 8150      		subi r24,1
 179 008a 990B      		sbc r25,r25
  64:ps2/ps2.c     **** 		}
 180               		.loc 1 64 16 view .LVU30
 181 008c 21E0      		ldi r18,lo8(1)
 182 008e 30E0      		ldi r19,0
 183 0090 00C0      		rjmp 2f
 184               		1:
 185 0092 220F      		lsl r18
 186               		2:
 187 0094 8A95      		dec r24
 188 0096 02F4      		brpl 1b
  64:ps2/ps2.c     **** 		}
 189               		.loc 1 64 10 view .LVU31
 190 0098 8091 0000 		lds r24,_byte
 191 009c 822B      		or r24,r18
 192 009e 8093 0000 		sts _byte,r24
 193 00a2 00C0      		rjmp .L4
 194               	.L5:
  67:ps2/ps2.c     **** 	{
 195               		.loc 1 67 7 is_stmt 1 view .LVU32
  67:ps2/ps2.c     **** 	{
 196               		.loc 1 67 9 is_stmt 0 view .LVU33
 197 00a4 8930      		cpi r24,lo8(9)
 198 00a6 01F4      		brne .L6
  71:ps2/ps2.c     **** 	}
 199               		.loc 1 71 3 is_stmt 1 view .LVU34
 200 00a8 8091 0000 		lds r24,_byte
 201 00ac 0E94 0000 		call ps2_event
 202               	.LVL1:
 203 00b0 00C0      		rjmp .L4
 204               	.L6:
  73:ps2/ps2.c     **** 	{
 205               		.loc 1 73 7 view .LVU35
  73:ps2/ps2.c     **** 	{
 206               		.loc 1 73 9 is_stmt 0 view .LVU36
 207 00b2 8A30      		cpi r24,lo8(10)
 208 00b4 01F4      		brne .L4
 209 00b6 80E0      		ldi r24,0
 210 00b8 00C0      		rjmp .L7
 211               	.LBE13:
 212               	.LBE14:
 213               		.cfi_endproc
 214               	.LFE6:
 216               		.section	.progmem.data,"a",@progbits
 219               	__c.0:
 220 0000 5053 2F32 		.string	"PS/2 keyboard initialized"
 220      206B 6579 
 220      626F 6172 
 220      6420 696E 
 220      6974 6961 
 221               		.local	_bit
 222               		.comm	_bit,1,1
 223               		.local	_byte
 224               		.comm	_byte,1,1
 225               		.text
 226               	.Letext0:
 227               		.file 2 "/usr/lib/gcc/avr/12.2.0/include/stdint-gcc.h"
 228               		.file 3 "logger/logger.h"
 229               		.file 4 "ps2/ps2.h"
 230               		.file 5 "../../types/types.h"
DEFINED SYMBOLS
                            *ABS*:00000000 ps2.c
     /tmp/ccrKdHOH.s:2      *ABS*:0000003e __SP_H__
     /tmp/ccrKdHOH.s:3      *ABS*:0000003d __SP_L__
     /tmp/ccrKdHOH.s:4      *ABS*:0000003f __SREG__
     /tmp/ccrKdHOH.s:5      *ABS*:00000000 __tmp_reg__
     /tmp/ccrKdHOH.s:6      *ABS*:00000001 __zero_reg__
     /tmp/ccrKdHOH.s:13     .text:00000000 ps2_init
     /tmp/ccrKdHOH.s:16     .text:00000000 .Loc.0
     /tmp/ccrKdHOH.s:17     .text:00000000 L0
     /tmp/ccrKdHOH.s:22     .text:00000000 .Loc.1
     /tmp/ccrKdHOH.s:23     .text:00000000 .Loc.2
     /tmp/ccrKdHOH.s:25     .text:00000002 .Loc.3
     /tmp/ccrKdHOH.s:29     .text:00000008 .Loc.4
     /tmp/ccrKdHOH.s:32     .text:0000000c .Loc.5
     /tmp/ccrKdHOH.s:34     .text:0000000c .Loc.6
     /tmp/ccrKdHOH.s:35     .text:0000000c .Loc.7
     /tmp/ccrKdHOH.s:37     .text:0000000c .Loc.8
     /tmp/ccrKdHOH.s:219    .progmem.data:00000000 __c.0
     /tmp/ccrKdHOH.s:48     .text:0000001a .Loc.9
     /tmp/ccrKdHOH.s:55     .text:00000022 L0
     /tmp/ccrKdHOH.s:60     .text:00000022 __vector_1
     /tmp/ccrKdHOH.s:62     .text:00000022 .Loc.10
     /tmp/ccrKdHOH.s:63     .text:00000022 L0
     /tmp/ccrKdHOH.s:113    .text:00000044 .Loc.11
     /tmp/ccrKdHOH.s:116    .text:00000044 .Loc.12
     /tmp/ccrKdHOH.s:118    .text:00000044 .Loc.13
     /tmp/ccrKdHOH.s:119    .text:00000044 .Loc.14
                             .bss:00000000 _bit
     /tmp/ccrKdHOH.s:121    .text:00000048 .Loc.15
     /tmp/ccrKdHOH.s:124    .text:0000004c .Loc.16
     /tmp/ccrKdHOH.s:125    .text:0000004c .Loc.17
     /tmp/ccrKdHOH.s:222    .bss:00000001 _byte
     /tmp/ccrKdHOH.s:128    .text:00000050 .Loc.18
     /tmp/ccrKdHOH.s:132    .text:00000056 .Loc.19
     /tmp/ccrKdHOH.s:137    .text:0000005a .Loc.20
     /tmp/ccrKdHOH.s:158    .text:0000007c .Loc.21
     /tmp/ccrKdHOH.s:159    .text:0000007c .Loc.22
     /tmp/ccrKdHOH.s:162    .text:00000080 .Loc.23
     /tmp/ccrKdHOH.s:165    .text:00000084 .Loc.24
     /tmp/ccrKdHOH.s:168    .text:00000084 .Loc.25
     /tmp/ccrKdHOH.s:170    .text:00000084 .Loc.26
     /tmp/ccrKdHOH.s:173    .text:00000084 .Loc.27
     /tmp/ccrKdHOH.s:176    .text:00000088 .Loc.28
     /tmp/ccrKdHOH.s:177    .text:00000088 .Loc.29
     /tmp/ccrKdHOH.s:180    .text:0000008c .Loc.30
     /tmp/ccrKdHOH.s:189    .text:00000098 .Loc.31
     /tmp/ccrKdHOH.s:195    .text:000000a4 .Loc.32
     /tmp/ccrKdHOH.s:196    .text:000000a4 .Loc.33
     /tmp/ccrKdHOH.s:199    .text:000000a8 .Loc.34
     /tmp/ccrKdHOH.s:205    .text:000000b2 .Loc.35
     /tmp/ccrKdHOH.s:206    .text:000000b2 .Loc.36
     /tmp/ccrKdHOH.s:213    .text:000000ba L0
     /tmp/ccrKdHOH.s:231    .text:000000ba L0
                     .debug_frame:00000000 L0
     /tmp/ccrKdHOH.s:155    .text:0000007c .L3
     /tmp/ccrKdHOH.s:194    .text:000000a4 .L5
     /tmp/ccrKdHOH.s:127    .text:00000050 .L4
     /tmp/ccrKdHOH.s:186    .text:00000094 .L21
     /tmp/ccrKdHOH.s:184    .text:00000092 .L11
     /tmp/ccrKdHOH.s:204    .text:000000b2 .L6
     /tmp/ccrKdHOH.s:131    .text:00000056 .L7
     /tmp/ccrKdHOH.s:461    .debug_abbrev:00000000 .Ldebug_abbrev0
     /tmp/ccrKdHOH.s:8      .text:00000000 .Ltext0
     /tmp/ccrKdHOH.s:226    .text:000000ba .Letext0
     /tmp/ccrKdHOH.s:820    .debug_line:00000000 .Ldebug_line0
     /tmp/ccrKdHOH.s:61     .text:00000022 .LFB6
     /tmp/ccrKdHOH.s:214    .text:000000ba .LFE6
     /tmp/ccrKdHOH.s:115    .text:00000044 .LBI9
     /tmp/ccrKdHOH.s:810    .debug_rnglists:0000000c .LLRL0
     /tmp/ccrKdHOH.s:167    .text:00000084 .LBI11
     /tmp/ccrKdHOH.s:166    .text:00000084 .LBB11
     /tmp/ccrKdHOH.s:172    .text:00000084 .LBE11
     /tmp/ccrKdHOH.s:202    .text:000000b0 .LVL1
     /tmp/ccrKdHOH.s:14     .text:00000000 .LFB3
     /tmp/ccrKdHOH.s:56     .text:00000022 .LFE3
     /tmp/ccrKdHOH.s:33     .text:0000000c .LBB4
     /tmp/ccrKdHOH.s:36     .text:0000000c .LBE4
     /tmp/ccrKdHOH.s:47     .text:0000001a .LVL0
     /tmp/ccrKdHOH.s:232    .debug_info:00000000 .Ldebug_info0

UNDEFINED SYMBOLS
log_boot_P
ps2_event
__do_clear_bss
