   1               		.file	"ps2.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.text
   8               	.Ltext0:
   9               		.cfi_sections	.debug_frame
  10               		.file 0 "/home/files/osdev/platform/avr" "ps2/ps2.c"
  11               	.global	ps2_init
  13               	ps2_init:
  14               	.LFB3:
  15               		.file 1 "ps2/ps2.c"
   1:ps2/ps2.c     **** /**
   2:ps2/ps2.c     ****  * @file    ps2.c
   3:ps2/ps2.c     ****  * @author  Haron Nazari, Anton Tchekov
   4:ps2/ps2.c     ****  * @version 0.1
   5:ps2/ps2.c     ****  * @date    16.05.2023
   6:ps2/ps2.c     ****  */
   7:ps2/ps2.c     **** 
   8:ps2/ps2.c     **** #include <ps2.h>
   9:ps2/ps2.c     **** #include <logger.h>
  10:ps2/ps2.c     **** #include <gpio.h>
  11:ps2/ps2.c     **** #include <avr/pgmspace.h>
  12:ps2/ps2.c     **** 
  13:ps2/ps2.c     **** /** The byte that is currently being received */
  14:ps2/ps2.c     **** static u8 _byte;
  15:ps2/ps2.c     **** 
  16:ps2/ps2.c     **** /**
  17:ps2/ps2.c     ****  * The number of the current bit:
  18:ps2/ps2.c     ****  *
  19:ps2/ps2.c     ****  *   0: Start bit
  20:ps2/ps2.c     ****  * 1-8: Data bit
  21:ps2/ps2.c     ****  *   9: Parity bit
  22:ps2/ps2.c     ****  *  10: Stop bit
  23:ps2/ps2.c     ****  */
  24:ps2/ps2.c     **** static u8 _bit;
  25:ps2/ps2.c     **** 
  26:ps2/ps2.c     **** void ps2_init(void)
  27:ps2/ps2.c     **** {
  16               		.loc 1 27 1 view -0
  17               		.cfi_startproc
  18               	/* prologue: function */
  19               	/* frame size = 0 */
  20               	/* stack size = 0 */
  21               	.L__stack_usage = 0
  28:ps2/ps2.c     **** 	/* Enable external interrupt 0 (PORTB2) */
  29:ps2/ps2.c     **** 	EIMSK |= (1 << PS2_EXT_INTERRUPT);
  22               		.loc 1 29 2 view .LVU1
  23               		.loc 1 29 8 is_stmt 0 view .LVU2
  24 0000 E89A      		sbi 0x1d,0
  30:ps2/ps2.c     **** 
  31:ps2/ps2.c     **** 	/* Trigger interrupt on falling edge */
  32:ps2/ps2.c     **** 	EICRA |= (1 << ISC01);
  25               		.loc 1 32 2 is_stmt 1 view .LVU3
  26 0002 E9E6      		ldi r30,lo8(105)
  27 0004 F0E0      		ldi r31,0
  28 0006 8081      		ld r24,Z
  29               		.loc 1 32 8 is_stmt 0 view .LVU4
  30 0008 8260      		ori r24,lo8(2)
  31 000a 8083      		st Z,r24
  33:ps2/ps2.c     **** 
  34:ps2/ps2.c     **** 	log_boot_P(PSTR("PS/2 keyboard initialized"));
  32               		.loc 1 34 2 is_stmt 1 view .LVU5
  33               	.LBB4:
  34               		.loc 1 34 13 view .LVU6
  35               		.loc 1 34 13 view .LVU7
  36               	.LBE4:
  37               		.loc 1 34 2 is_stmt 0 view .LVU8
  38 000c 80E0      		ldi r24,lo8(__c.0)
  39 000e 90E0      		ldi r25,hi8(__c.0)
  40 0010 9F93      		push r25
  41               		.cfi_def_cfa_offset 3
  42 0012 8F93      		push r24
  43               		.cfi_def_cfa_offset 4
  44 0014 0E94 0000 		call log_boot_P
  45               	.LVL0:
  35:ps2/ps2.c     **** }
  46               		.loc 1 35 1 view .LVU9
  47 0018 0F90      		pop __tmp_reg__
  48 001a 0F90      		pop __tmp_reg__
  49               		.cfi_def_cfa_offset 2
  50               	/* epilogue start */
  51 001c 0895      		ret
  52               		.cfi_endproc
  53               	.LFE3:
  55               	.global	__vector_1
  57               	__vector_1:
  58               	.LFB6:
  36:ps2/ps2.c     **** 
  37:ps2/ps2.c     **** /**
  38:ps2/ps2.c     ****  * @brief Get the PS/2 data line state
  39:ps2/ps2.c     ****  *
  40:ps2/ps2.c     ****  * @return 0 if LOW, non-zero if HIGH
  41:ps2/ps2.c     ****  */
  42:ps2/ps2.c     **** static inline u8 _ps2_data_read(void)
  43:ps2/ps2.c     **** {
  44:ps2/ps2.c     **** 	/* Read keyboard data pin */
  45:ps2/ps2.c     **** 	return PS2_DATA_PORT_IN & (1 << PS2_DATA_PIN);
  46:ps2/ps2.c     **** }
  47:ps2/ps2.c     **** 
  48:ps2/ps2.c     **** /**
  49:ps2/ps2.c     ****  * @brief Called when a falling edge is detected on the PS/2 clock pin
  50:ps2/ps2.c     ****  */
  51:ps2/ps2.c     **** static inline void _ps2_clock_falling_edge(void)
  52:ps2/ps2.c     **** {
  53:ps2/ps2.c     **** 	if(_bit == 0)
  54:ps2/ps2.c     **** 	{
  55:ps2/ps2.c     **** 		/* Start bit, reset byte */
  56:ps2/ps2.c     **** 		_byte = 0;
  57:ps2/ps2.c     **** 	}
  58:ps2/ps2.c     **** 	else if(_bit >= 1 && _bit <= 8)
  59:ps2/ps2.c     **** 	{
  60:ps2/ps2.c     **** 		/* Data bit */
  61:ps2/ps2.c     **** 		if(_ps2_data_read())
  62:ps2/ps2.c     **** 		{
  63:ps2/ps2.c     **** 			/* Set bit */
  64:ps2/ps2.c     **** 			_byte |= (1 << (_bit - 1));
  65:ps2/ps2.c     **** 		}
  66:ps2/ps2.c     **** 	}
  67:ps2/ps2.c     **** 	else if(_bit == 9)
  68:ps2/ps2.c     **** 	{
  69:ps2/ps2.c     **** 		/* Ignore parity bit */
  70:ps2/ps2.c     **** 		/* TODO: Check parity bit */
  71:ps2/ps2.c     **** 		ps2_event(_byte);
  72:ps2/ps2.c     **** 	}
  73:ps2/ps2.c     **** 	else if(_bit == 10)
  74:ps2/ps2.c     **** 	{
  75:ps2/ps2.c     **** 		/* Stop bit, reset bit counter */
  76:ps2/ps2.c     **** 		_bit = 0;
  77:ps2/ps2.c     **** 
  78:ps2/ps2.c     **** 		/* Return immediately so it stays 0 */
  79:ps2/ps2.c     **** 		return;
  80:ps2/ps2.c     **** 	}
  81:ps2/ps2.c     **** 
  82:ps2/ps2.c     **** 	++_bit;
  83:ps2/ps2.c     **** }
  84:ps2/ps2.c     **** 
  85:ps2/ps2.c     **** /** External interrupt */
  86:ps2/ps2.c     **** ISR(INT0_vect)
  87:ps2/ps2.c     **** {
  59               		.loc 1 87 1 is_stmt 1 view -0
  60               		.cfi_startproc
  61 001e 1F92      		push r1
  62               		.cfi_def_cfa_offset 3
  63               		.cfi_offset 1, -2
  64 0020 0F92      		push r0
  65               		.cfi_def_cfa_offset 4
  66               		.cfi_offset 0, -3
  67 0022 0FB6      		in r0,__SREG__
  68 0024 0F92      		push r0
  69 0026 1124      		clr __zero_reg__
  70 0028 2F93      		push r18
  71               		.cfi_def_cfa_offset 5
  72               		.cfi_offset 18, -4
  73 002a 3F93      		push r19
  74               		.cfi_def_cfa_offset 6
  75               		.cfi_offset 19, -5
  76 002c 4F93      		push r20
  77               		.cfi_def_cfa_offset 7
  78               		.cfi_offset 20, -6
  79 002e 5F93      		push r21
  80               		.cfi_def_cfa_offset 8
  81               		.cfi_offset 21, -7
  82 0030 6F93      		push r22
  83               		.cfi_def_cfa_offset 9
  84               		.cfi_offset 22, -8
  85 0032 7F93      		push r23
  86               		.cfi_def_cfa_offset 10
  87               		.cfi_offset 23, -9
  88 0034 8F93      		push r24
  89               		.cfi_def_cfa_offset 11
  90               		.cfi_offset 24, -10
  91 0036 9F93      		push r25
  92               		.cfi_def_cfa_offset 12
  93               		.cfi_offset 25, -11
  94 0038 AF93      		push r26
  95               		.cfi_def_cfa_offset 13
  96               		.cfi_offset 26, -12
  97 003a BF93      		push r27
  98               		.cfi_def_cfa_offset 14
  99               		.cfi_offset 27, -13
 100 003c EF93      		push r30
 101               		.cfi_def_cfa_offset 15
 102               		.cfi_offset 30, -14
 103 003e FF93      		push r31
 104               		.cfi_def_cfa_offset 16
 105               		.cfi_offset 31, -15
 106               	/* prologue: Signal */
 107               	/* frame size = 0 */
 108               	/* stack size = 15 */
 109               	.L__stack_usage = 15
  88:ps2/ps2.c     **** 	_ps2_clock_falling_edge();
 110               		.loc 1 88 2 view .LVU11
 111               	.LBB9:
 112               	.LBI9:
  51:ps2/ps2.c     **** {
 113               		.loc 1 51 20 view .LVU12
 114               	.LBB10:
  53:ps2/ps2.c     **** 	{
 115               		.loc 1 53 2 view .LVU13
  53:ps2/ps2.c     **** 	{
 116               		.loc 1 53 10 is_stmt 0 view .LVU14
 117 0040 8091 0000 		lds r24,_bit
  53:ps2/ps2.c     **** 	{
 118               		.loc 1 53 4 view .LVU15
 119 0044 8111      		cpse r24,__zero_reg__
 120 0046 00C0      		rjmp .L3
  56:ps2/ps2.c     **** 	}
 121               		.loc 1 56 3 is_stmt 1 view .LVU16
  56:ps2/ps2.c     **** 	}
 122               		.loc 1 56 9 is_stmt 0 view .LVU17
 123 0048 1092 0000 		sts _byte,__zero_reg__
 124               	.L4:
  82:ps2/ps2.c     **** }
 125               		.loc 1 82 2 is_stmt 1 view .LVU18
 126 004c 8091 0000 		lds r24,_bit
 127 0050 8F5F      		subi r24,lo8(-(1))
 128               	.L7:
  76:ps2/ps2.c     **** 
 129               		.loc 1 76 8 is_stmt 0 view .LVU19
 130 0052 8093 0000 		sts _bit,r24
 131               	/* epilogue start */
 132               	.LBE10:
 133               	.LBE9:
  89:ps2/ps2.c     **** }
 134               		.loc 1 89 1 view .LVU20
 135 0056 FF91      		pop r31
 136 0058 EF91      		pop r30
 137 005a BF91      		pop r27
 138 005c AF91      		pop r26
 139 005e 9F91      		pop r25
 140 0060 8F91      		pop r24
 141 0062 7F91      		pop r23
 142 0064 6F91      		pop r22
 143 0066 5F91      		pop r21
 144 0068 4F91      		pop r20
 145 006a 3F91      		pop r19
 146 006c 2F91      		pop r18
 147 006e 0F90      		pop r0
 148 0070 0FBE      		out __SREG__,r0
 149 0072 0F90      		pop r0
 150 0074 1F90      		pop r1
 151 0076 1895      		reti
 152               	.L3:
 153               	.LBB14:
 154               	.LBB13:
  58:ps2/ps2.c     **** 	{
 155               		.loc 1 58 7 is_stmt 1 view .LVU21
  58:ps2/ps2.c     **** 	{
 156               		.loc 1 58 20 is_stmt 0 view .LVU22
 157 0078 9FEF      		ldi r25,lo8(-1)
 158 007a 980F      		add r25,r24
  58:ps2/ps2.c     **** 	{
 159               		.loc 1 58 9 view .LVU23
 160 007c 9830      		cpi r25,lo8(8)
 161 007e 00F4      		brsh .L5
  61:ps2/ps2.c     **** 		{
 162               		.loc 1 61 3 is_stmt 1 view .LVU24
 163               	.LBB11:
 164               	.LBI11:
  42:ps2/ps2.c     **** {
 165               		.loc 1 42 18 view .LVU25
 166               	.LBB12:
  45:ps2/ps2.c     **** }
 167               		.loc 1 45 2 view .LVU26
 168               	.LBE12:
 169               	.LBE11:
  61:ps2/ps2.c     **** 		{
 170               		.loc 1 61 5 is_stmt 0 view .LVU27
 171 0080 1B9B      		sbis 0x3,3
 172 0082 00C0      		rjmp .L4
  64:ps2/ps2.c     **** 		}
 173               		.loc 1 64 4 is_stmt 1 view .LVU28
  64:ps2/ps2.c     **** 		}
 174               		.loc 1 64 25 is_stmt 0 view .LVU29
 175 0084 8150      		subi r24,1
 176 0086 990B      		sbc r25,r25
  64:ps2/ps2.c     **** 		}
 177               		.loc 1 64 16 view .LVU30
 178 0088 21E0      		ldi r18,lo8(1)
 179 008a 30E0      		ldi r19,0
 180 008c 00C0      		rjmp 2f
 181               		1:
 182 008e 220F      		lsl r18
 183               		2:
 184 0090 8A95      		dec r24
 185 0092 02F4      		brpl 1b
  64:ps2/ps2.c     **** 		}
 186               		.loc 1 64 10 view .LVU31
 187 0094 8091 0000 		lds r24,_byte
 188 0098 822B      		or r24,r18
 189 009a 8093 0000 		sts _byte,r24
 190 009e 00C0      		rjmp .L4
 191               	.L5:
  67:ps2/ps2.c     **** 	{
 192               		.loc 1 67 7 is_stmt 1 view .LVU32
  67:ps2/ps2.c     **** 	{
 193               		.loc 1 67 9 is_stmt 0 view .LVU33
 194 00a0 8930      		cpi r24,lo8(9)
 195 00a2 01F4      		brne .L6
  71:ps2/ps2.c     **** 	}
 196               		.loc 1 71 3 is_stmt 1 view .LVU34
 197 00a4 8091 0000 		lds r24,_byte
 198 00a8 0E94 0000 		call ps2_event
 199               	.LVL1:
 200 00ac 00C0      		rjmp .L4
 201               	.L6:
  73:ps2/ps2.c     **** 	{
 202               		.loc 1 73 7 view .LVU35
  73:ps2/ps2.c     **** 	{
 203               		.loc 1 73 9 is_stmt 0 view .LVU36
 204 00ae 8A30      		cpi r24,lo8(10)
 205 00b0 01F4      		brne .L4
 206 00b2 80E0      		ldi r24,0
 207 00b4 00C0      		rjmp .L7
 208               	.LBE13:
 209               	.LBE14:
 210               		.cfi_endproc
 211               	.LFE6:
 213               		.section	.progmem.data,"a",@progbits
 216               	__c.0:
 217 0000 5053 2F32 		.string	"PS/2 keyboard initialized"
 217      206B 6579 
 217      626F 6172 
 217      6420 696E 
 217      6974 6961 
 218               		.local	_bit
 219               		.comm	_bit,1,1
 220               		.local	_byte
 221               		.comm	_byte,1,1
 222               		.text
 223               	.Letext0:
 224               		.file 2 "ps2/ps2.h"
 225               		.file 3 "logger/logger.h"
 226               		.file 4 "/usr/lib/gcc/avr/12.2.0/include/stdint-gcc.h"
 227               		.file 5 "../../types/types.h"
DEFINED SYMBOLS
                            *ABS*:00000000 ps2.c
     /tmp/cckuVS5o.s:2      *ABS*:0000003e __SP_H__
     /tmp/cckuVS5o.s:3      *ABS*:0000003d __SP_L__
     /tmp/cckuVS5o.s:4      *ABS*:0000003f __SREG__
     /tmp/cckuVS5o.s:5      *ABS*:00000000 __tmp_reg__
     /tmp/cckuVS5o.s:6      *ABS*:00000001 __zero_reg__
     /tmp/cckuVS5o.s:13     .text:00000000 ps2_init
     /tmp/cckuVS5o.s:16     .text:00000000 .Loc.0
     /tmp/cckuVS5o.s:17     .text:00000000 L0
     /tmp/cckuVS5o.s:22     .text:00000000 .Loc.1
     /tmp/cckuVS5o.s:23     .text:00000000 .Loc.2
     /tmp/cckuVS5o.s:25     .text:00000002 .Loc.3
     /tmp/cckuVS5o.s:29     .text:00000008 .Loc.4
     /tmp/cckuVS5o.s:32     .text:0000000c .Loc.5
     /tmp/cckuVS5o.s:34     .text:0000000c .Loc.6
     /tmp/cckuVS5o.s:35     .text:0000000c .Loc.7
     /tmp/cckuVS5o.s:37     .text:0000000c .Loc.8
     /tmp/cckuVS5o.s:216    .progmem.data:00000000 __c.0
     /tmp/cckuVS5o.s:46     .text:00000018 .Loc.9
     /tmp/cckuVS5o.s:52     .text:0000001e L0
     /tmp/cckuVS5o.s:57     .text:0000001e __vector_1
     /tmp/cckuVS5o.s:59     .text:0000001e .Loc.10
     /tmp/cckuVS5o.s:60     .text:0000001e L0
     /tmp/cckuVS5o.s:110    .text:00000040 .Loc.11
     /tmp/cckuVS5o.s:113    .text:00000040 .Loc.12
     /tmp/cckuVS5o.s:115    .text:00000040 .Loc.13
     /tmp/cckuVS5o.s:116    .text:00000040 .Loc.14
                             .bss:00000000 _bit
     /tmp/cckuVS5o.s:118    .text:00000044 .Loc.15
     /tmp/cckuVS5o.s:121    .text:00000048 .Loc.16
     /tmp/cckuVS5o.s:122    .text:00000048 .Loc.17
     /tmp/cckuVS5o.s:219    .bss:00000001 _byte
     /tmp/cckuVS5o.s:125    .text:0000004c .Loc.18
     /tmp/cckuVS5o.s:129    .text:00000052 .Loc.19
     /tmp/cckuVS5o.s:134    .text:00000056 .Loc.20
     /tmp/cckuVS5o.s:155    .text:00000078 .Loc.21
     /tmp/cckuVS5o.s:156    .text:00000078 .Loc.22
     /tmp/cckuVS5o.s:159    .text:0000007c .Loc.23
     /tmp/cckuVS5o.s:162    .text:00000080 .Loc.24
     /tmp/cckuVS5o.s:165    .text:00000080 .Loc.25
     /tmp/cckuVS5o.s:167    .text:00000080 .Loc.26
     /tmp/cckuVS5o.s:170    .text:00000080 .Loc.27
     /tmp/cckuVS5o.s:173    .text:00000084 .Loc.28
     /tmp/cckuVS5o.s:174    .text:00000084 .Loc.29
     /tmp/cckuVS5o.s:177    .text:00000088 .Loc.30
     /tmp/cckuVS5o.s:186    .text:00000094 .Loc.31
     /tmp/cckuVS5o.s:192    .text:000000a0 .Loc.32
     /tmp/cckuVS5o.s:193    .text:000000a0 .Loc.33
     /tmp/cckuVS5o.s:196    .text:000000a4 .Loc.34
     /tmp/cckuVS5o.s:202    .text:000000ae .Loc.35
     /tmp/cckuVS5o.s:203    .text:000000ae .Loc.36
     /tmp/cckuVS5o.s:210    .text:000000b6 L0
     /tmp/cckuVS5o.s:228    .text:000000b6 L0
                     .debug_frame:00000000 L0
     /tmp/cckuVS5o.s:152    .text:00000078 .L3
     /tmp/cckuVS5o.s:191    .text:000000a0 .L5
     /tmp/cckuVS5o.s:124    .text:0000004c .L4
     /tmp/cckuVS5o.s:183    .text:00000090 .L21
     /tmp/cckuVS5o.s:181    .text:0000008e .L11
     /tmp/cckuVS5o.s:201    .text:000000ae .L6
     /tmp/cckuVS5o.s:128    .text:00000052 .L7
     /tmp/cckuVS5o.s:417    .debug_abbrev:00000000 .Ldebug_abbrev0
     /tmp/cckuVS5o.s:8      .text:00000000 .Ltext0
     /tmp/cckuVS5o.s:223    .text:000000b6 .Letext0
     /tmp/cckuVS5o.s:748    .debug_line:00000000 .Ldebug_line0
     /tmp/cckuVS5o.s:58     .text:0000001e .LFB6
     /tmp/cckuVS5o.s:211    .text:000000b6 .LFE6
     /tmp/cckuVS5o.s:112    .text:00000040 .LBI9
     /tmp/cckuVS5o.s:738    .debug_rnglists:0000000c .LLRL0
     /tmp/cckuVS5o.s:164    .text:00000080 .LBI11
     /tmp/cckuVS5o.s:163    .text:00000080 .LBB11
     /tmp/cckuVS5o.s:169    .text:00000080 .LBE11
     /tmp/cckuVS5o.s:199    .text:000000ac .LVL1
     /tmp/cckuVS5o.s:14     .text:00000000 .LFB3
     /tmp/cckuVS5o.s:53     .text:0000001e .LFE3
     /tmp/cckuVS5o.s:33     .text:0000000c .LBB4
     /tmp/cckuVS5o.s:36     .text:0000000c .LBE4
     /tmp/cckuVS5o.s:45     .text:00000018 .LVL0
     /tmp/cckuVS5o.s:229    .debug_info:00000000 .Ldebug_info0

UNDEFINED SYMBOLS
log_boot_P
ps2_event
__do_clear_bss
