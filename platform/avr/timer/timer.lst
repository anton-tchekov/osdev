   1               		.file	"timer.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.text
   8               	.Ltext0:
   9               		.cfi_sections	.debug_frame
  10               		.file 0 "/home/files/osdev/platform/avr" "timer/timer.c"
  11               	.global	timer_init
  13               	timer_init:
  14               	.LFB3:
  15               		.file 1 "timer/timer.c"
   1:timer/timer.c **** /**
   2:timer/timer.c ****  * @file    timer.c
   3:timer/timer.c ****  * @author  Tim Gabrikowski, Anton Tchekov
   4:timer/timer.c ****  * @version 0.1
   5:timer/timer.c ****  * @date    01.05.2023
   6:timer/timer.c ****  */
   7:timer/timer.c **** 
   8:timer/timer.c **** #include <timer.h>
   9:timer/timer.c **** #include <logger.h>
  10:timer/timer.c **** #include <avr/interrupt.h>
  11:timer/timer.c **** #include <avr/pgmspace.h>
  12:timer/timer.c **** 
  13:timer/timer.c **** static const char _msg_timer[] PROGMEM = "Millisecond timer initialized";
  14:timer/timer.c **** 
  15:timer/timer.c **** static volatile u32 _ms;
  16:timer/timer.c **** 
  17:timer/timer.c **** void timer_init(void)
  18:timer/timer.c **** {
  16               		.loc 1 18 1 view -0
  17               		.cfi_startproc
  18               	/* prologue: function */
  19               	/* frame size = 0 */
  20               	/* stack size = 0 */
  21               	.L__stack_usage = 0
  19:timer/timer.c **** 	/* Initialize hardware timers */
  20:timer/timer.c **** 
  21:timer/timer.c **** 	/* CTC Mode */
  22:timer/timer.c **** 	TCCR0A = (1 << WGM01);
  22               		.loc 1 22 2 view .LVU1
  23               		.loc 1 22 9 is_stmt 0 view .LVU2
  24 0000 82E0      		ldi r24,lo8(2)
  25 0002 84BD      		out 0x24,r24
  23:timer/timer.c **** 
  24:timer/timer.c **** 	/* Prescaler 128 */
  25:timer/timer.c **** 	TCCR0B |= (1 << CS02) | (1 << CS00);
  26               		.loc 1 25 2 is_stmt 1 view .LVU3
  27 0004 85B5      		in r24,0x25
  28               		.loc 1 25 9 is_stmt 0 view .LVU4
  29 0006 8560      		ori r24,lo8(5)
  30 0008 85BD      		out 0x25,r24
  26:timer/timer.c **** 
  27:timer/timer.c **** 	/* 16000000 / 128 / 1000 = 125 */
  28:timer/timer.c **** 	OCR0A = 125 - 1;
  31               		.loc 1 28 2 is_stmt 1 view .LVU5
  32               		.loc 1 28 8 is_stmt 0 view .LVU6
  33 000a 8CE7      		ldi r24,lo8(124)
  34 000c 87BD      		out 0x27,r24
  29:timer/timer.c **** 
  30:timer/timer.c **** 	/* Enable compare interrupt */
  31:timer/timer.c **** 	TIMSK0 |= (1 << OCIE0A);
  35               		.loc 1 31 2 is_stmt 1 view .LVU7
  36 000e EEE6      		ldi r30,lo8(110)
  37 0010 F0E0      		ldi r31,0
  38 0012 8081      		ld r24,Z
  39               		.loc 1 31 9 is_stmt 0 view .LVU8
  40 0014 8260      		ori r24,lo8(2)
  41 0016 8083      		st Z,r24
  32:timer/timer.c **** 
  33:timer/timer.c **** 	log_boot(_msg_timer);
  42               		.loc 1 33 2 is_stmt 1 view .LVU9
  43 0018 80E0      		ldi r24,lo8(_msg_timer)
  44 001a 90E0      		ldi r25,hi8(_msg_timer)
  45 001c 0C94 0000 		jmp log_boot
  46               	.LVL0:
  47               		.cfi_endproc
  48               	.LFE3:
  50               	.global	millis
  52               	millis:
  53               	.LFB4:
  34:timer/timer.c **** }
  35:timer/timer.c **** 
  36:timer/timer.c **** u32 millis(void)
  37:timer/timer.c **** {
  54               		.loc 1 37 1 view -0
  55               		.cfi_startproc
  56 0020 CF93      		push r28
  57               		.cfi_def_cfa_offset 3
  58               		.cfi_offset 28, -2
  59 0022 DF93      		push r29
  60               		.cfi_def_cfa_offset 4
  61               		.cfi_offset 29, -3
  62 0024 00D0      		rcall .
  63 0026 00D0      		rcall .
  64               		.cfi_def_cfa_offset 8
  65 0028 CDB7      		in r28,__SP_L__
  66 002a DEB7      		in r29,__SP_H__
  67               		.cfi_def_cfa_register 28
  68               	/* prologue: function */
  69               	/* frame size = 4 */
  70               	/* stack size = 6 */
  71               	.L__stack_usage = 6
  38:timer/timer.c **** 	/* Return number of milliseconds since boot */
  39:timer/timer.c **** 	return _ms;
  72               		.loc 1 39 2 view .LVU11
  73               		.loc 1 39 9 is_stmt 0 view .LVU12
  74 002c 8091 0000 		lds r24,_ms
  75 0030 9091 0000 		lds r25,_ms+1
  76 0034 A091 0000 		lds r26,_ms+2
  77 0038 B091 0000 		lds r27,_ms+3
  40:timer/timer.c **** }
  78               		.loc 1 40 1 view .LVU13
  79 003c BC01      		movw r22,r24
  80 003e CD01      		movw r24,r26
  81               	/* epilogue start */
  82 0040 0F90      		pop __tmp_reg__
  83 0042 0F90      		pop __tmp_reg__
  84 0044 0F90      		pop __tmp_reg__
  85 0046 0F90      		pop __tmp_reg__
  86 0048 DF91      		pop r29
  87 004a CF91      		pop r28
  88 004c 0895      		ret
  89               		.cfi_endproc
  90               	.LFE4:
  92               	.global	__vector_14
  94               	__vector_14:
  95               	.LFB5:
  41:timer/timer.c **** 
  42:timer/timer.c **** /* Timer0 compare interrupt */
  43:timer/timer.c **** ISR(TIMER0_COMPA_vect)
  44:timer/timer.c **** {
  96               		.loc 1 44 1 is_stmt 1 view -0
  97               		.cfi_startproc
  98 004e 1F92 1FB6 		__gcc_isr 1
  98      1F92 1124 
  98      8F93 
  99 0058 9F93      		push r25
 100               		.cfi_def_cfa_offset 3
 101               		.cfi_offset 25, -2
 102 005a AF93      		push r26
 103               		.cfi_def_cfa_offset 4
 104               		.cfi_offset 26, -3
 105 005c BF93      		push r27
 106               		.cfi_def_cfa_offset 5
 107               		.cfi_offset 27, -4
 108               	/* prologue: Signal */
 109               	/* frame size = 0 */
 110               	/* stack size = 3...7 */
 111               	.L__stack_usage = 3 + __gcc_isr.n_pushed
  45:timer/timer.c **** 	/* Increment overflows after approx. 50 days */
  46:timer/timer.c **** 	++_ms;
 112               		.loc 1 46 2 view .LVU15
 113 005e 8091 0000 		lds r24,_ms
 114 0062 9091 0000 		lds r25,_ms+1
 115 0066 A091 0000 		lds r26,_ms+2
 116 006a B091 0000 		lds r27,_ms+3
 117 006e 0196      		adiw r24,1
 118 0070 A11D      		adc r26,__zero_reg__
 119 0072 B11D      		adc r27,__zero_reg__
 120 0074 8093 0000 		sts _ms,r24
 121 0078 9093 0000 		sts _ms+1,r25
 122 007c A093 0000 		sts _ms+2,r26
 123 0080 B093 0000 		sts _ms+3,r27
 124               	/* epilogue start */
  47:timer/timer.c **** }
 125               		.loc 1 47 1 is_stmt 0 view .LVU16
 126 0084 BF91      		pop r27
 127 0086 AF91      		pop r26
 128 0088 9F91      		pop r25
 129 008a 8F91 1F90 		__gcc_isr 2
 129      1FBE 1F90 
 130 0092 1895      		reti
 131               		__gcc_isr 0,r24
 132               		.cfi_endproc
 133               	.LFE5:
 135               		.local	_ms
 136               		.comm	_ms,4,1
 137               		.section	.progmem.data,"a",@progbits
 140               	_msg_timer:
 141 0000 4D69 6C6C 		.string	"Millisecond timer initialized"
 141      6973 6563 
 141      6F6E 6420 
 141      7469 6D65 
 141      7220 696E 
 142               		.text
 143               	.Letext0:
 144               		.file 2 "/usr/lib/gcc/avr/12.2.0/include/stdint-gcc.h"
 145               		.file 3 "../../types/types.h"
 146               		.file 4 "logger/logger.h"
DEFINED SYMBOLS
                            *ABS*:00000000 timer.c
     /tmp/cc30HuQI.s:2      *ABS*:0000003e __SP_H__
     /tmp/cc30HuQI.s:3      *ABS*:0000003d __SP_L__
     /tmp/cc30HuQI.s:4      *ABS*:0000003f __SREG__
     /tmp/cc30HuQI.s:5      *ABS*:00000000 __tmp_reg__
     /tmp/cc30HuQI.s:6      *ABS*:00000001 __zero_reg__
     /tmp/cc30HuQI.s:13     .text:00000000 timer_init
     /tmp/cc30HuQI.s:16     .text:00000000 .Loc.0
     /tmp/cc30HuQI.s:17     .text:00000000 L0
     /tmp/cc30HuQI.s:22     .text:00000000 .Loc.1
     /tmp/cc30HuQI.s:23     .text:00000000 .Loc.2
     /tmp/cc30HuQI.s:26     .text:00000004 .Loc.3
     /tmp/cc30HuQI.s:28     .text:00000006 .Loc.4
     /tmp/cc30HuQI.s:31     .text:0000000a .Loc.5
     /tmp/cc30HuQI.s:32     .text:0000000a .Loc.6
     /tmp/cc30HuQI.s:35     .text:0000000e .Loc.7
     /tmp/cc30HuQI.s:39     .text:00000014 .Loc.8
     /tmp/cc30HuQI.s:42     .text:00000018 .Loc.9
     /tmp/cc30HuQI.s:140    .progmem.data:00000000 _msg_timer
     /tmp/cc30HuQI.s:47     .text:00000020 L0
     /tmp/cc30HuQI.s:52     .text:00000020 millis
     /tmp/cc30HuQI.s:54     .text:00000020 .Loc.10
     /tmp/cc30HuQI.s:55     .text:00000020 L0
     /tmp/cc30HuQI.s:62     .text:00000026 L0
     /tmp/cc30HuQI.s:63     .text:00000028 L0
     /tmp/cc30HuQI.s:72     .text:0000002c .Loc.11
     /tmp/cc30HuQI.s:73     .text:0000002c .Loc.12
                             .bss:00000000 _ms
     /tmp/cc30HuQI.s:78     .text:0000003c .Loc.13
     /tmp/cc30HuQI.s:89     .text:0000004e L0
     /tmp/cc30HuQI.s:94     .text:0000004e __vector_14
     /tmp/cc30HuQI.s:96     .text:0000004e .Loc.14
     /tmp/cc30HuQI.s:97     .text:0000004e L0
                            *ABS*:00000003 __gcc_isr.n_pushed.001
     /tmp/cc30HuQI.s:112    .text:0000005e .Loc.15
     /tmp/cc30HuQI.s:125    .text:00000084 .Loc.16
     /tmp/cc30HuQI.s:132    .text:00000094 L0
     /tmp/cc30HuQI.s:147    .text:00000094 L0
                     .debug_frame:00000000 L0
     /tmp/cc30HuQI.s:311    .debug_abbrev:00000000 .Ldebug_abbrev0
     /tmp/cc30HuQI.s:8      .text:00000000 .Ltext0
     /tmp/cc30HuQI.s:143    .text:00000094 .Letext0
     /tmp/cc30HuQI.s:598    .debug_line:00000000 .Ldebug_line0
     /tmp/cc30HuQI.s:95     .text:0000004e .LFB5
     /tmp/cc30HuQI.s:133    .text:00000094 .LFE5
     /tmp/cc30HuQI.s:53     .text:00000020 .LFB4
     /tmp/cc30HuQI.s:90     .text:0000004e .LFE4
     /tmp/cc30HuQI.s:14     .text:00000000 .LFB3
     /tmp/cc30HuQI.s:48     .text:00000020 .LFE3
     /tmp/cc30HuQI.s:46     .text:00000020 .LVL0
     /tmp/cc30HuQI.s:148    .debug_info:00000000 .Ldebug_info0

UNDEFINED SYMBOLS
log_boot
__do_clear_bss
