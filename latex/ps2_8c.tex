\hypertarget{ps2_8c}{}\doxysection{platform/avr/ps2/ps2.c File Reference}
\label{ps2_8c}\index{platform/avr/ps2/ps2.c@{platform/avr/ps2/ps2.c}}
{\ttfamily \#include $<$ps2.\+h$>$}\newline
{\ttfamily \#include $<$logger.\+h$>$}\newline
{\ttfamily \#include $<$gpio.\+h$>$}\newline
{\ttfamily \#include $<$avr/pgmspace.\+h$>$}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{ps2_8c_af0a83745146d1ce5fe4ef4372520e372}{ps2\+\_\+init}} (void)
\begin{DoxyCompactList}\small\item\em Initialize PS/2 keyboard driver and interrupt, Interrupts must be enabled afterwards using {\ttfamily sei()}. \end{DoxyCompactList}\item 
static \mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} \mbox{\hyperlink{ps2_8c_ad3a3737fe89541c8d9a4d1e2720352e6}{\+\_\+ps2\+\_\+data\+\_\+read}} (void)
\begin{DoxyCompactList}\small\item\em Get the PS/2 data line state. \end{DoxyCompactList}\item 
static void \mbox{\hyperlink{ps2_8c_a34ac3f4ba7a6a188c75b585f69bdded6}{\+\_\+ps2\+\_\+clock\+\_\+falling\+\_\+edge}} (void)
\begin{DoxyCompactList}\small\item\em Called when a falling edge is detected on the PS/2 clock pin. \end{DoxyCompactList}\item 
\mbox{\hyperlink{ps2_8c_afea150fcd685610cb9f7672fce361e53}{ISR}} (INT0\+\_\+vect)
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} \mbox{\hyperlink{ps2_8c_aa117bb08f41b6564dbe438b3648d9ae7}{\+\_\+byte}}
\item 
static \mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} \mbox{\hyperlink{ps2_8c_aa4a39acdc6c6f92da3da447491d71b72}{\+\_\+bit}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\begin{DoxyAuthor}{Author}
Haron Nazari, Anton Tchekov 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
0.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
16.\+05.\+2023 
\end{DoxyDate}


Definition in file \mbox{\hyperlink{ps2_8c_source}{ps2.\+c}}.



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{ps2_8c_a34ac3f4ba7a6a188c75b585f69bdded6}\label{ps2_8c_a34ac3f4ba7a6a188c75b585f69bdded6}} 
\index{ps2.c@{ps2.c}!\_ps2\_clock\_falling\_edge@{\_ps2\_clock\_falling\_edge}}
\index{\_ps2\_clock\_falling\_edge@{\_ps2\_clock\_falling\_edge}!ps2.c@{ps2.c}}
\doxysubsubsection{\texorpdfstring{\_ps2\_clock\_falling\_edge()}{\_ps2\_clock\_falling\_edge()}}
{\footnotesize\ttfamily static void \+\_\+ps2\+\_\+clock\+\_\+falling\+\_\+edge (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Called when a falling edge is detected on the PS/2 clock pin. 



Definition at line \mbox{\hyperlink{ps2_8c_source_l00051}{51}} of file \mbox{\hyperlink{ps2_8c_source}{ps2.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00052\ \{}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{ps2_8c_aa4a39acdc6c6f92da3da447491d71b72}{\_bit}}\ ==\ 0)}
\DoxyCodeLine{00054\ \ \ \ \ \{}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Start\ bit,\ reset\ byte\ */}}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ps2_8c_aa117bb08f41b6564dbe438b3648d9ae7}{\_byte}}\ =\ 0;}
\DoxyCodeLine{00057\ \ \ \ \ \}}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\mbox{\hyperlink{ps2_8c_aa4a39acdc6c6f92da3da447491d71b72}{\_bit}}\ >=\ 1\ \&\&\ \mbox{\hyperlink{ps2_8c_aa4a39acdc6c6f92da3da447491d71b72}{\_bit}}\ <=\ 8)}
\DoxyCodeLine{00059\ \ \ \ \ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Data\ bit\ */}}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{ps2_8c_ad3a3737fe89541c8d9a4d1e2720352e6}{\_ps2\_data\_read}}())}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Set\ bit\ */}}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ps2_8c_aa117bb08f41b6564dbe438b3648d9ae7}{\_byte}}\ |=\ (1\ <<\ (\mbox{\hyperlink{ps2_8c_aa4a39acdc6c6f92da3da447491d71b72}{\_bit}}\ -\/\ 1));}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00066\ \ \ \ \ \}}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\mbox{\hyperlink{ps2_8c_aa4a39acdc6c6f92da3da447491d71b72}{\_bit}}\ ==\ 9)}
\DoxyCodeLine{00068\ \ \ \ \ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Ignore\ parity\ bit\ */}}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ TODO:\ Check\ parity\ bit\ */}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ ps2\_event(\mbox{\hyperlink{ps2_8c_aa117bb08f41b6564dbe438b3648d9ae7}{\_byte}});}
\DoxyCodeLine{00072\ \ \ \ \ \}}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\mbox{\hyperlink{ps2_8c_aa4a39acdc6c6f92da3da447491d71b72}{\_bit}}\ ==\ 10)}
\DoxyCodeLine{00074\ \ \ \ \ \{}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Stop\ bit,\ reset\ bit\ counter\ */}}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ps2_8c_aa4a39acdc6c6f92da3da447491d71b72}{\_bit}}\ =\ 0;}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Return\ immediately\ so\ it\ stays\ 0\ */}}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00080\ \ \ \ \ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \ \ ++\mbox{\hyperlink{ps2_8c_aa4a39acdc6c6f92da3da447491d71b72}{\_bit}};}
\DoxyCodeLine{00083\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{ps2_8c_source_l00024}{\+\_\+bit}}, \mbox{\hyperlink{ps2_8c_source_l00014}{\+\_\+byte}}, and \mbox{\hyperlink{ps2_8c_source_l00042}{\+\_\+ps2\+\_\+data\+\_\+read()}}.



Referenced by \mbox{\hyperlink{ps2_8c_source_l00086}{ISR()}}.

\mbox{\Hypertarget{ps2_8c_ad3a3737fe89541c8d9a4d1e2720352e6}\label{ps2_8c_ad3a3737fe89541c8d9a4d1e2720352e6}} 
\index{ps2.c@{ps2.c}!\_ps2\_data\_read@{\_ps2\_data\_read}}
\index{\_ps2\_data\_read@{\_ps2\_data\_read}!ps2.c@{ps2.c}}
\doxysubsubsection{\texorpdfstring{\_ps2\_data\_read()}{\_ps2\_data\_read()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} \+\_\+ps2\+\_\+data\+\_\+read (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Get the PS/2 data line state. 

\begin{DoxyReturn}{Returns}
0 if LOW, non-\/zero if HIGH 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{ps2_8c_source_l00042}{42}} of file \mbox{\hyperlink{ps2_8c_source}{ps2.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00043\ \{}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{comment}{/*\ Read\ keyboard\ data\ pin\ */}}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{gpio_8h_a85a6dfc067aff42f3ff68450bc72e728}{PS2\_DATA\_PORT\_IN}}\ \&\ (1\ <<\ \mbox{\hyperlink{gpio_8h_a9de0e05d896f00ad46cc166cd0d0146b}{PS2\_DATA\_PIN}});}
\DoxyCodeLine{00046\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{gpio_8h_source_l00142}{PS2\+\_\+\+DATA\+\_\+\+PIN}}, and \mbox{\hyperlink{gpio_8h_source_l00136}{PS2\+\_\+\+DATA\+\_\+\+PORT\+\_\+\+IN}}.



Referenced by \mbox{\hyperlink{ps2_8c_source_l00051}{\+\_\+ps2\+\_\+clock\+\_\+falling\+\_\+edge()}}.

\mbox{\Hypertarget{ps2_8c_afea150fcd685610cb9f7672fce361e53}\label{ps2_8c_afea150fcd685610cb9f7672fce361e53}} 
\index{ps2.c@{ps2.c}!ISR@{ISR}}
\index{ISR@{ISR}!ps2.c@{ps2.c}}
\doxysubsubsection{\texorpdfstring{ISR()}{ISR()}}
{\footnotesize\ttfamily ISR (\begin{DoxyParamCaption}\item[{INT0\+\_\+vect}]{ }\end{DoxyParamCaption})}

External interrupt 

Definition at line \mbox{\hyperlink{ps2_8c_source_l00086}{86}} of file \mbox{\hyperlink{ps2_8c_source}{ps2.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00087\ \{}
\DoxyCodeLine{00088\ \ \ \ \ \mbox{\hyperlink{ps2_8c_a34ac3f4ba7a6a188c75b585f69bdded6}{\_ps2\_clock\_falling\_edge}}();}
\DoxyCodeLine{00089\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{ps2_8c_source_l00051}{\+\_\+ps2\+\_\+clock\+\_\+falling\+\_\+edge()}}.

\mbox{\Hypertarget{ps2_8c_af0a83745146d1ce5fe4ef4372520e372}\label{ps2_8c_af0a83745146d1ce5fe4ef4372520e372}} 
\index{ps2.c@{ps2.c}!ps2\_init@{ps2\_init}}
\index{ps2\_init@{ps2\_init}!ps2.c@{ps2.c}}
\doxysubsubsection{\texorpdfstring{ps2\_init()}{ps2\_init()}}
{\footnotesize\ttfamily void ps2\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Initialize PS/2 keyboard driver and interrupt, Interrupts must be enabled afterwards using {\ttfamily sei()}. 



Definition at line \mbox{\hyperlink{ps2_8c_source_l00026}{26}} of file \mbox{\hyperlink{ps2_8c_source}{ps2.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00027\ \{}
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{comment}{/*\ Enable\ external\ interrupt\ 0\ (PORTB2)\ */}}
\DoxyCodeLine{00029\ \ \ \ \ EIMSK\ |=\ (1\ <<\ \mbox{\hyperlink{gpio_8h_a34ea49db58f76f1619e460765995f599}{PS2\_EXT\_INTERRUPT}});}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{comment}{/*\ Trigger\ interrupt\ on\ falling\ edge\ */}}
\DoxyCodeLine{00032\ \ \ \ \ EICRA\ |=\ (1\ <<\ ISC01);}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ \ \ \mbox{\hyperlink{logger_8c_a60bd636ef160c97eb51cf31be5954ba2}{log\_boot\_P}}(LOG\_INIT,\ PSTR(\textcolor{stringliteral}{"{}PS/2\ keyboard\ initialized"{}}));}
\DoxyCodeLine{00035\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{logger_8c_source_l00164}{log\+\_\+boot\+\_\+\+P()}}, and \mbox{\hyperlink{gpio_8h_source_l00129}{PS2\+\_\+\+EXT\+\_\+\+INTERRUPT}}.



\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{ps2_8c_aa4a39acdc6c6f92da3da447491d71b72}\label{ps2_8c_aa4a39acdc6c6f92da3da447491d71b72}} 
\index{ps2.c@{ps2.c}!\_bit@{\_bit}}
\index{\_bit@{\_bit}!ps2.c@{ps2.c}}
\doxysubsubsection{\texorpdfstring{\_bit}{\_bit}}
{\footnotesize\ttfamily \mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} \+\_\+bit\hspace{0.3cm}{\ttfamily [static]}}

The number of the current bit\+:

0\+: Start bit 1-\/8\+: Data bit 9\+: Parity bit 10\+: Stop bit 

Definition at line \mbox{\hyperlink{ps2_8c_source_l00024}{24}} of file \mbox{\hyperlink{ps2_8c_source}{ps2.\+c}}.



Referenced by \mbox{\hyperlink{ps2_8c_source_l00051}{\+\_\+ps2\+\_\+clock\+\_\+falling\+\_\+edge()}}.

\mbox{\Hypertarget{ps2_8c_aa117bb08f41b6564dbe438b3648d9ae7}\label{ps2_8c_aa117bb08f41b6564dbe438b3648d9ae7}} 
\index{ps2.c@{ps2.c}!\_byte@{\_byte}}
\index{\_byte@{\_byte}!ps2.c@{ps2.c}}
\doxysubsubsection{\texorpdfstring{\_byte}{\_byte}}
{\footnotesize\ttfamily \mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} \+\_\+byte\hspace{0.3cm}{\ttfamily [static]}}

The byte that is currently being received 

Definition at line \mbox{\hyperlink{ps2_8c_source_l00014}{14}} of file \mbox{\hyperlink{ps2_8c_source}{ps2.\+c}}.



Referenced by \mbox{\hyperlink{ps2_8c_source_l00051}{\+\_\+ps2\+\_\+clock\+\_\+falling\+\_\+edge()}}.

