\hypertarget{mkinitrd_2main_8c}{}\doxysection{mkinitrd/main.c File Reference}
\label{mkinitrd_2main_8c}\index{mkinitrd/main.c@{mkinitrd/main.c}}


Boot image creator.  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$types.\+h$>$}\newline
{\ttfamily \#include $<$atfs.\+h$>$}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{mkinitrd_2main_8c_a3c04138a5bfe5d72780bb7e82a18e627}{main}} (int argc, char $\ast$$\ast$argv)
\begin{DoxyCompactList}\small\item\em Mk\+Init\+RD Main. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Boot image creator. 

\begin{DoxyAuthor}{Author}
Anton Tchekov 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
0.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
21.\+05.\+2023 
\end{DoxyDate}


Definition in file \mbox{\hyperlink{mkinitrd_2main_8c_source}{main.\+c}}.



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{mkinitrd_2main_8c_a3c04138a5bfe5d72780bb7e82a18e627}\label{mkinitrd_2main_8c_a3c04138a5bfe5d72780bb7e82a18e627}} 
\index{main.c@{main.c}!main@{main}}
\index{main@{main}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$$\ast$}]{argv }\end{DoxyParamCaption})}



Mk\+Init\+RD Main. 


\begin{DoxyParams}{Parameters}
{\em argc} & Number of command line parameters \\
\hline
{\em argv} & Array of command line parameters \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Exit code 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{mkinitrd_2main_8c_source_l00022}{22}} of file \mbox{\hyperlink{mkinitrd_2main_8c_source}{main.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00023\ \{}
\DoxyCodeLine{00024\ \ \ \ \ \mbox{\hyperlink{types_8h_afaa62991928fb9fb18ff0db62a040aba}{u32}}\ i,\ size;}
\DoxyCodeLine{00025\ \ \ \ \ \mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}}\ buf[\mbox{\hyperlink{sd_8h_ad51ded0bbd705f02f73fc60c0b721ced}{BLOCK\_SIZE}}];}
\DoxyCodeLine{00026\ \ \ \ \ FILE\ *in,\ *out;}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keywordtype}{char}\ *in\_filename,\ *out\_filename;}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{keywordflow}{if}(argc\ !=\ 3)}
\DoxyCodeLine{00030\ \ \ \ \ \{}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}Usage:\ ./mkinitrd\ input-\/binary\ output-\/disk-\/image\(\backslash\)n"{}});}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00033\ \ \ \ \ \}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \ \ \ \ in\_filename\ =\ argv[1];}
\DoxyCodeLine{00036\ \ \ \ \ out\_filename\ =\ argv[2];}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keywordflow}{if}(!(in\ =\ fopen(in\_filename,\ \textcolor{stringliteral}{"{}rb"{}})))}
\DoxyCodeLine{00039\ \ \ \ \ \{}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}Failed\ to\ open\ input\ file\ \(\backslash\)"{}\%s\(\backslash\)"{}\(\backslash\)n"{}},\ in\_filename);}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00042\ \ \ \ \ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordflow}{if}(!(out\ =\ fopen(out\_filename,\ \textcolor{stringliteral}{"{}wb"{}})))}
\DoxyCodeLine{00045\ \ \ \ \ \{}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}Failed\ to\ open\ output\ file\ \(\backslash\)"{}\%s\(\backslash\)"{}\(\backslash\)n"{}},\ out\_filename);}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00048\ \ \ \ \ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ fseek(in,\ 0,\ SEEK\_END);}
\DoxyCodeLine{00051\ \ \ \ \ size\ =\ ftell(in);}
\DoxyCodeLine{00052\ \ \ \ \ fseek(in,\ 0,\ SEEK\_SET);}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{string_8c_ab5fb910d7238069eb23f4b06809aa68e}{memset}}(buf,\ 0,\ \mbox{\hyperlink{sd_8h_ad51ded0bbd705f02f73fc60c0b721ced}{BLOCK\_SIZE}});}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \mbox{\hyperlink{string_8c_a6ea826c42748b85ae7c74f1e2ccf7c27}{memcpy}}(buf\ +\ OFFSET\_SIGNATURE,\ \mbox{\hyperlink{atfs_8h_adf3e5683d8b4681edf588f58e4a02494}{\_atfs\_signature}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{atfs_8h_adf3e5683d8b4681edf588f58e4a02494}{\_atfs\_signature}}));}
\DoxyCodeLine{00057\ \ \ \ \ \_write\_le\_32(buf\ +\ OFFSET\_REVISION,\ REVISION);}
\DoxyCodeLine{00058\ \ \ \ \ \_write\_le\_32(buf\ +\ OFFSET\_STDLIB\_SIZE,\ 0);}
\DoxyCodeLine{00059\ \ \ \ \ \_write\_le\_32(buf\ +\ OFFSET\_INIT\_SIZE,\ size);}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ fwrite(buf,\ 1,\ \mbox{\hyperlink{sd_8h_ad51ded0bbd705f02f73fc60c0b721ced}{BLOCK\_SIZE}},\ out);}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{comment}{/*\ Write\ 64\ empty\ sectors\ */}}
\DoxyCodeLine{00064\ \ \ \ \ \mbox{\hyperlink{string_8c_ab5fb910d7238069eb23f4b06809aa68e}{memset}}(buf,\ 0,\ \mbox{\hyperlink{sd_8h_ad51ded0bbd705f02f73fc60c0b721ced}{BLOCK\_SIZE}});}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keywordflow}{for}(i\ =\ 0;\ i\ <\ SIZE\_STDLIB;\ ++i)}
\DoxyCodeLine{00066\ \ \ \ \ \{}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ fwrite(buf,\ 1,\ \mbox{\hyperlink{sd_8h_ad51ded0bbd705f02f73fc60c0b721ced}{BLOCK\_SIZE}},\ out);}
\DoxyCodeLine{00068\ \ \ \ \ \}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{comment}{/*\ Write\ init\ program\ */}}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordflow}{for}(i\ =\ 0;\ i\ <\ SIZE\_INIT;\ ++i)}
\DoxyCodeLine{00072\ \ \ \ \ \{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{string_8c_ab5fb910d7238069eb23f4b06809aa68e}{memset}}(buf,\ 0,\ \mbox{\hyperlink{sd_8h_ad51ded0bbd705f02f73fc60c0b721ced}{BLOCK\_SIZE}});}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ fread(buf,\ 1,\ \mbox{\hyperlink{sd_8h_ad51ded0bbd705f02f73fc60c0b721ced}{BLOCK\_SIZE}},\ in);}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ fwrite(buf,\ 1,\ \mbox{\hyperlink{sd_8h_ad51ded0bbd705f02f73fc60c0b721ced}{BLOCK\_SIZE}},\ out);}
\DoxyCodeLine{00076\ \ \ \ \ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{comment}{/*\ TEMPORARY:\ End\ marker\ 0xFF\ root\ dir\ sector\ */}}
\DoxyCodeLine{00079\ \ \ \ \ \mbox{\hyperlink{string_8c_ab5fb910d7238069eb23f4b06809aa68e}{memset}}(buf,\ 0xFF,\ \mbox{\hyperlink{sd_8h_ad51ded0bbd705f02f73fc60c0b721ced}{BLOCK\_SIZE}});}
\DoxyCodeLine{00080\ \ \ \ \ fwrite(buf,\ 1,\ \mbox{\hyperlink{sd_8h_ad51ded0bbd705f02f73fc60c0b721ced}{BLOCK\_SIZE}},\ out);}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00082\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{atfs_8h_source_l00059}{\+\_\+atfs\+\_\+signature}}, \mbox{\hyperlink{sd_8h_source_l00016}{BLOCK\+\_\+\+SIZE}}, \mbox{\hyperlink{mkinitrd_2main_8c_source_l00022}{main()}}, \mbox{\hyperlink{string_8c_source_l00094}{memcpy()}}, and \mbox{\hyperlink{string_8c_source_l00176}{memset()}}.



Referenced by \mbox{\hyperlink{mkinitrd_2main_8c_source_l00022}{main()}}.

