\doxysection{main.\+c}
\hypertarget{mkinitrd_2main_8c_source}{}\label{mkinitrd_2main_8c_source}\index{mkinitrd/main.c@{mkinitrd/main.c}}
\mbox{\hyperlink{mkinitrd_2main_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00001}00001\ }
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00009}00009\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00010}00010\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00011}00011\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{string_8h}{string.h}}>}}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00012}00012\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{types_8h}{types.h}}>}}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00013}00013\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{atfs_8h}{atfs.h}}>}}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00014}00014\ }
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00022}\mbox{\hyperlink{mkinitrd_2main_8c_a3c04138a5bfe5d72780bb7e82a18e627}{00022}}\ \textcolor{keywordtype}{int}\ main(\textcolor{keywordtype}{int}\ argc,\ \textcolor{keywordtype}{char}\ **argv)}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00023}00023\ \{}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00024}00024\ \ \ \ \ \mbox{\hyperlink{types_8h_afaa62991928fb9fb18ff0db62a040aba}{u32}}\ i,\ size;}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00025}00025\ \ \ \ \ \mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}}\ buf[\mbox{\hyperlink{atfs_8h_a92b9c24f31f47693e78b3f27be5905ed}{ATFS\_BLOCK\_SIZE}}];}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00026}00026\ \ \ \ \ FILE\ *in,\ *out;}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00027}00027\ \ \ \ \ \textcolor{keywordtype}{char}\ *in\_filename,\ *out\_filename;}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00028}00028\ }
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00029}00029\ \ \ \ \ \textcolor{keywordflow}{if}(argc\ !=\ 3)}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00030}00030\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00031}00031\ \ \ \ \ \ \ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}Usage:\ ./mkinitrd\ input-\/binary\ output-\/disk-\/image\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00032}00032\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00033}00033\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00034}00034\ }
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00035}00035\ \ \ \ \ in\_filename\ =\ argv[1];}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00036}00036\ \ \ \ \ out\_filename\ =\ argv[2];}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00037}00037\ }
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00038}00038\ \ \ \ \ \textcolor{keywordflow}{if}(!(in\ =\ fopen(in\_filename,\ \textcolor{stringliteral}{"{}rb"{}})))}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00039}00039\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00040}00040\ \ \ \ \ \ \ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}Failed\ to\ open\ input\ file\ \(\backslash\)"{}\%s\(\backslash\)"{}\(\backslash\)n"{}},\ in\_filename);}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00041}00041\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00042}00042\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00043}00043\ }
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00044}00044\ \ \ \ \ \textcolor{keywordflow}{if}(!(out\ =\ fopen(out\_filename,\ \textcolor{stringliteral}{"{}wb"{}})))}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00045}00045\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00046}00046\ \ \ \ \ \ \ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}Failed\ to\ open\ output\ file\ \(\backslash\)"{}\%s\(\backslash\)"{}\(\backslash\)n"{}},\ out\_filename);}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00047}00047\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00048}00048\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00049}00049\ }
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00050}00050\ \ \ \ \ fseek(in,\ 0,\ SEEK\_END);}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00051}00051\ \ \ \ \ size\ =\ ftell(in);}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00052}00052\ \ \ \ \ fseek(in,\ 0,\ SEEK\_SET);}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00053}00053\ }
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00054}00054\ \ \ \ \ \textcolor{comment}{/*\ Write\ boot\ sector\ */}}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00055}00055\ \ \ \ \ \mbox{\hyperlink{string_8c_ab5fb910d7238069eb23f4b06809aa68e}{memset}}(buf,\ 0,\ \mbox{\hyperlink{atfs_8h_a92b9c24f31f47693e78b3f27be5905ed}{ATFS\_BLOCK\_SIZE}});}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00056}00056\ \ \ \ \ \mbox{\hyperlink{string_8c_a6ea826c42748b85ae7c74f1e2ccf7c27}{memcpy}}(buf\ +\ \mbox{\hyperlink{atfs_8h_a2ea0d3fde1f46a1b5b3d1ab55b7e3d5b}{ATFS\_OFFSET\_SIGNATURE}},\ \mbox{\hyperlink{atfs_8h_adf3e5683d8b4681edf588f58e4a02494}{\_atfs\_signature}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{atfs_8h_adf3e5683d8b4681edf588f58e4a02494}{\_atfs\_signature}}));}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00057}00057\ \ \ \ \ \mbox{\hyperlink{atfs_8h_a62a1835558e5a5dfeade49e10d2682b8}{write\_le\_32}}(buf\ +\ \mbox{\hyperlink{atfs_8h_afa4c7c978e0253bb3c3e2b6828b49afd}{ATFS\_OFFSET\_REVISION}},\ \mbox{\hyperlink{atfs_8h_a57c1cdf2546cad6e7458aa3f4b19f527}{ATFS\_REVISION}});}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00058}00058\ \ \ \ \ \mbox{\hyperlink{atfs_8h_a62a1835558e5a5dfeade49e10d2682b8}{write\_le\_32}}(buf\ +\ \mbox{\hyperlink{atfs_8h_a7d10d042743a7e70205c1d82f8b3785b}{ATFS\_OFFSET\_INIT\_BLOCK}},\ 1);}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00059}00059\ \ \ \ \ \mbox{\hyperlink{atfs_8h_a62a1835558e5a5dfeade49e10d2682b8}{write\_le\_32}}(buf\ +\ \mbox{\hyperlink{atfs_8h_ac61a5c871bbbb33f1f12c644bb7b105a}{ATFS\_OFFSET\_INIT\_SIZE}},\ size);}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00060}00060\ \ \ \ \ fwrite(buf,\ 1,\ \mbox{\hyperlink{atfs_8h_a92b9c24f31f47693e78b3f27be5905ed}{ATFS\_BLOCK\_SIZE}},\ out);}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00061}00061\ }
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00062}00062\ \ \ \ \ \textcolor{comment}{/*\ Write\ init\ program\ */}}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00063}00063\ \ \ \ \ \textcolor{keywordflow}{for}(i\ =\ 0;\ i\ <\ (size\ +\ \mbox{\hyperlink{atfs_8h_a92b9c24f31f47693e78b3f27be5905ed}{ATFS\_BLOCK\_SIZE}}\ -\/\ 1)\ /\ \mbox{\hyperlink{atfs_8h_a92b9c24f31f47693e78b3f27be5905ed}{ATFS\_BLOCK\_SIZE}};\ ++i)}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00064}00064\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00065}00065\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{string_8c_ab5fb910d7238069eb23f4b06809aa68e}{memset}}(buf,\ 0,\ \mbox{\hyperlink{atfs_8h_a92b9c24f31f47693e78b3f27be5905ed}{ATFS\_BLOCK\_SIZE}});}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00066}00066\ \ \ \ \ \ \ \ \ fread(buf,\ 1,\ \mbox{\hyperlink{atfs_8h_a92b9c24f31f47693e78b3f27be5905ed}{ATFS\_BLOCK\_SIZE}},\ in);}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00067}00067\ \ \ \ \ \ \ \ \ fwrite(buf,\ 1,\ \mbox{\hyperlink{atfs_8h_a92b9c24f31f47693e78b3f27be5905ed}{ATFS\_BLOCK\_SIZE}},\ out);}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00068}00068\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00069}00069\ }
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00070}00070\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{mkinitrd_2main_8c_source_l00071}00071\ \}}

\end{DoxyCode}
