\hypertarget{platform_2avr_2main_8c}{}\doxysection{platform/avr/main.c File Reference}
\label{platform_2avr_2main_8c}\index{platform/avr/main.c@{platform/avr/main.c}}


AVR Main.  


{\ttfamily \#include $<$ps2.\+h$>$}\newline
{\ttfamily \#include $<$serial.\+h$>$}\newline
{\ttfamily \#include $<$adc.\+h$>$}\newline
{\ttfamily \#include $<$random.\+h$>$}\newline
{\ttfamily \#include $<$timer.\+h$>$}\newline
{\ttfamily \#include $<$xmem.\+h$>$}\newline
{\ttfamily \#include $<$logger.\+h$>$}\newline
{\ttfamily \#include $<$spi.\+h$>$}\newline
{\ttfamily \#include $<$lcd.\+h$>$}\newline
{\ttfamily \#include $<$gpio.\+h$>$}\newline
{\ttfamily \#include $<$sd.\+h$>$}\newline
{\ttfamily \#include $<$initrd.\+h$>$}\newline
{\ttfamily \#include $<$avr/pgmspace.\+h$>$}\newline
{\ttfamily \#include $<$emulator.\+h$>$}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{platform_2avr_2main_8c_a840291bc02cba5474a4cb46a9b9566fe}{main}} (void)
\item 
char \mbox{\hyperlink{platform_2avr_2main_8c_a5c2f84aeedc37fa06591a71be6dc55e4}{byte\+\_\+to\+\_\+hex}} (\mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} byte)
\item 
void \mbox{\hyperlink{platform_2avr_2main_8c_af7f4bc35d95b7572e19fff58cbf089f6}{ps2\+\_\+event}} (\mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} byte)
\begin{DoxyCompactList}\small\item\em This function must be implemented by the user and is called by the driver when a byte is received. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
AVR Main. 

\begin{DoxyAuthor}{Author}
Anton Tchekov 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
0.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
25.\+05.\+2023 
\end{DoxyDate}


Definition in file \mbox{\hyperlink{platform_2avr_2main_8c_source}{main.\+c}}.



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{platform_2avr_2main_8c_a5c2f84aeedc37fa06591a71be6dc55e4}\label{platform_2avr_2main_8c_a5c2f84aeedc37fa06591a71be6dc55e4}} 
\index{main.c@{main.c}!byte\_to\_hex@{byte\_to\_hex}}
\index{byte\_to\_hex@{byte\_to\_hex}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{byte\_to\_hex()}{byte\_to\_hex()}}
{\footnotesize\ttfamily char byte\+\_\+to\+\_\+hex (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}}}]{byte }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{platform_2avr_2main_8c_source_l00087}{87}} of file \mbox{\hyperlink{platform_2avr_2main_8c_source}{main.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00088\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keywordflow}{if}(\textcolor{keywordtype}{byte}\ <\ 10)}
\DoxyCodeLine{00090\ \ \ \ \ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keywordtype}{byte}\ +\ \textcolor{charliteral}{'0'};}
\DoxyCodeLine{00092\ \ \ \ \ \}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keywordtype}{byte}\ -\/\ 10\ +\ \textcolor{charliteral}{'A'};}
\DoxyCodeLine{00095\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{platform_2avr_2main_8c_a840291bc02cba5474a4cb46a9b9566fe}\label{platform_2avr_2main_8c_a840291bc02cba5474a4cb46a9b9566fe}} 
\index{main.c@{main.c}!main@{main}}
\index{main@{main}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{platform_2avr_2main_8c_source_l00024}{24}} of file \mbox{\hyperlink{platform_2avr_2main_8c_source}{main.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00025\ \{}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{comment}{/*\ -\/-\/-\/\ BOOT\ SEQUENCE\ -\/-\/-\/\ */}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{comment}{/*\ Enable\ interrupts\ */}}
\DoxyCodeLine{00029\ \ \ \ \ sei();}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{comment}{/*\ First,\ configure\ GPIO,\ because\ all\ modules\ that\ do\ I/O\ depend\ on\ it\ */}}
\DoxyCodeLine{00032\ \ \ \ \ \mbox{\hyperlink{gpio_8c_a7159e787d0c4fb89346383b7987ab6d3}{gpio\_configure}}();}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{comment}{/*\ Second,\ initialize\ serial\ port\ so\ that\ we\ can\ print\ boot\ messages\ */}}
\DoxyCodeLine{00035\ \ \ \ \ \mbox{\hyperlink{platform_2avr_2serial_2serial_8c_ad2b461e9e9044364a28a61cfadcacdd8}{serial\_init}}();}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{comment}{/*\ Print\ startup\ message\ */}}
\DoxyCodeLine{00038\ \ \ \ \ \mbox{\hyperlink{logger_8c_a60bd636ef160c97eb51cf31be5954ba2}{log\_boot\_P}}(LOG\_NONE,\ PSTR(\textcolor{stringliteral}{"{}\(\backslash\)nImaginaryOS\ Version\ 0.1\ Booting\ ...\(\backslash\)n"{}}));}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{comment}{/*\ Initialize\ millisecond\ timer\ */}}
\DoxyCodeLine{00041\ \ \ \ \ \mbox{\hyperlink{timer_8c_a7b8ab79df77b57475a5494f5f81c3bd9}{timer\_init}}();}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{comment}{/*\ Initialize\ SPI\ (Needed\ for\ SD\ Card,\ External\ Memory\ and\ LCD)\ */}}
\DoxyCodeLine{00044\ \ \ \ \ \mbox{\hyperlink{spi_8c_ae909944aa85ae98323073c628be541aa}{spi\_init}}();}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{comment}{/*\ Initialize\ LCD\ driver\ early\ for\ boot\ image\ and\ messages\ */}}
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{lcd_8c_a09748a4045dc2d014afdce2cc566e57d}{lcd\_init}}(0xFF,\ \mbox{\hyperlink{lcd_8h_aba2a7fe77a7501e5844370eec0185207}{COLOR\_BLACK}});}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{comment}{/*\ Initialize\ LCD\ Logger\ */}}
\DoxyCodeLine{00050\ \ \ \ \ \mbox{\hyperlink{logger_8c_aa60037dffd3fce2b3b698663eb11b5dc}{logger\_lcd\_init}}();}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{comment}{/*\ Initialize\ keyboard\ (fast)\ */}}
\DoxyCodeLine{00053\ \ \ \ \ \mbox{\hyperlink{ps2_8c_af0a83745146d1ce5fe4ef4372520e372}{ps2\_init}}();}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{comment}{/*\ Initialize\ ADC\ (fast)\ */}}
\DoxyCodeLine{00056\ \ \ \ \ \mbox{\hyperlink{adc_8c_a2b815e6730e8723a6d1d06d9ef8f31c0}{adc\_init}}();}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{comment}{/*\ Initialize\ RNG\ (fast)\ */}}
\DoxyCodeLine{00059\ \ \ \ \ \mbox{\hyperlink{random_8c_acc9caf986ad394f055fe6f511f7109f6}{random\_init}}();}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{comment}{/*\ Initialize\ external\ memory\ late\ because\ of\ slow\ memory\ test\ */}}
\DoxyCodeLine{00062\ \ \ \ \ \mbox{\hyperlink{xmem_8c_aa98b163510e84b9e79394397efdb8dde}{xmem\_init}}();}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{comment}{/*\ Initialize\ SD\ card\ driver\ */}}
\DoxyCodeLine{00065\ \ \ \ \ \mbox{\hyperlink{sd_8c_a8d7ab30b86b39a27f6fffac7495c1830}{sd\_init}}();}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{comment}{/*\ -\/-\/-\/\ READY\ -\/-\/-\/\ */}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{comment}{/*\ Load\ initial\ ram\ disk\ */}}
\DoxyCodeLine{00070\ \ \ \ \ \mbox{\hyperlink{initrd_8c_afb664c3988d855629cd7b611cf610561}{initrd\_load}}();}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ \mbox{\hyperlink{logger_8c_a60bd636ef160c97eb51cf31be5954ba2}{log\_boot\_P}}(LOG\_NONE,\ PSTR(\textcolor{stringliteral}{"{}\(\backslash\)nStarting\ RISC-\/V\ Emulator\ Kernel\ ...\(\backslash\)n\(\backslash\)n"{}}));}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \ \ \mbox{\hyperlink{emulator_8c_a0dbe43a64cbf994bf9189e7767f93342}{kernel\_init}}();}
\DoxyCodeLine{00075\ \ \ \ \ \mbox{\hyperlink{logger_8c_a60bd636ef160c97eb51cf31be5954ba2}{log\_boot\_P}}(LOG\_EXT,\ PSTR(\textcolor{stringliteral}{"{}Setup\ done!"{}}));}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{comment}{/*\ Infinite\ loop\ */}}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordflow}{for}(;;)}
\DoxyCodeLine{00079\ \ \ \ \ \{}
\DoxyCodeLine{00080\ \ \ \ \ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{comment}{/*\ Unreachable\ */}}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00084\ \}}

\end{DoxyCode}
\mbox{\Hypertarget{platform_2avr_2main_8c_af7f4bc35d95b7572e19fff58cbf089f6}\label{platform_2avr_2main_8c_af7f4bc35d95b7572e19fff58cbf089f6}} 
\index{main.c@{main.c}!ps2\_event@{ps2\_event}}
\index{ps2\_event@{ps2\_event}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{ps2\_event()}{ps2\_event()}}
{\footnotesize\ttfamily void ps2\+\_\+event (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}}}]{byte }\end{DoxyParamCaption})}



This function must be implemented by the user and is called by the driver when a byte is received. 


\begin{DoxyParams}{Parameters}
{\em byte} & The byte that was received from the PS/2 keyboard \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{platform_2avr_2main_8c_source_l00097}{97}} of file \mbox{\hyperlink{platform_2avr_2main_8c_source}{main.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00098\ \{}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{comment}{/*\ Called\ when\ a\ byte\ is\ received\ from\ the\ keyboard\ */}}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{comment}{/*\ serial\_tx('0');\ */}}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{comment}{/*\ serial\_tx('x');\ */}}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{comment}{/*\ serial\_tx(byte\_to\_hex((byte\ >>\ 4)\ \&\ 0x0F));\ */}}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{comment}{/*\ serial\_tx(byte\_to\_hex(byte\ \&\ 0x0F));\ */}}
\DoxyCodeLine{00104\ \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{ps2_8c_source_l00051}{\+\_\+ps2\+\_\+clock\+\_\+falling\+\_\+edge()}}.

