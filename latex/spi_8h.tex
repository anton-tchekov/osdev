\hypertarget{spi_8h}{}\doxysection{platform/avr/spi/spi.h File Reference}
\label{spi_8h}\index{platform/avr/spi/spi.h@{platform/avr/spi/spi.h}}


SPI interface driver.  


{\ttfamily \#include $<$types.\+h$>$}\newline
{\ttfamily \#include $<$status.\+h$>$}\newline
{\ttfamily \#include $<$avr/io.\+h$>$}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{spi_8h_ae909944aa85ae98323073c628be541aa}{spi\+\_\+init}} (void)
\begin{DoxyCompactList}\small\item\em Initialize the SPI interface. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{spi_8h_ab3e16cf26638212c1e54a7aa4878e12a}{spi\+\_\+fast}} (void)
\begin{DoxyCompactList}\small\item\em Enable fastest SPI mode. \end{DoxyCompactList}\item 
\mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} \mbox{\hyperlink{spi_8h_aa100766918afcb71b6ba79413f33f9db}{spi\+\_\+xchg}} (\mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} byte)
\begin{DoxyCompactList}\small\item\em Send and receive one byte from the SPI interface Panics on timeout. \end{DoxyCompactList}\item 
\mbox{\hyperlink{status_8h_a67a0db04d321a74b7e7fcfd3f1a3f70b}{Status}} \mbox{\hyperlink{spi_8h_a2195bbe087062b5ee88ebcdac1e53643}{spi\+\_\+xchg\+\_\+try}} (\mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} in, \mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} $\ast$out)
\begin{DoxyCompactList}\small\item\em Try to send and receive one byte from SPI. \end{DoxyCompactList}\item 
\mbox{\hyperlink{status_8h_a67a0db04d321a74b7e7fcfd3f1a3f70b}{Status}} \mbox{\hyperlink{spi_8h_a28af41e6c50d1f29c90a94e1041a8285}{spi\+\_\+tx\+\_\+try}} (\mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} in)
\begin{DoxyCompactList}\small\item\em Try to send one byte to the SPI interface. \end{DoxyCompactList}\item 
\mbox{\hyperlink{status_8h_a67a0db04d321a74b7e7fcfd3f1a3f70b}{Status}} \mbox{\hyperlink{spi_8h_a419efa4aed1b16b72a80d7a1356780d0}{spi\+\_\+rx\+\_\+try}} (\mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} $\ast$out)
\begin{DoxyCompactList}\small\item\em Try to receive one byte from the SPI interface. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
SPI interface driver. 

\begin{DoxyAuthor}{Author}
Anton Tchekov 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
0.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
16.\+05.\+2023 
\end{DoxyDate}


Definition in file \mbox{\hyperlink{spi_8h_source}{spi.\+h}}.



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{spi_8h_ab3e16cf26638212c1e54a7aa4878e12a}\label{spi_8h_ab3e16cf26638212c1e54a7aa4878e12a}} 
\index{spi.h@{spi.h}!spi\_fast@{spi\_fast}}
\index{spi\_fast@{spi\_fast}!spi.h@{spi.h}}
\doxysubsubsection{\texorpdfstring{spi\_fast()}{spi\_fast()}}
{\footnotesize\ttfamily void spi\+\_\+fast (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Enable fastest SPI mode. 



Definition at line \mbox{\hyperlink{spi_8c_source_l00018}{18}} of file \mbox{\hyperlink{spi_8c_source}{spi.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00019\ \{}
\DoxyCodeLine{00020\ \ \ \ \ SPCR\ \&=\ \string~((1\ <<\ SPR1)\ |\ (1\ <<\ SPR0));}
\DoxyCodeLine{00021\ \ \ \ \ SPSR\ |=\ (1\ <<\ SPI2X);}
\DoxyCodeLine{00022\ \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{lcd_8c_source_l00225}{\+\_\+lcd\+\_\+window\+\_\+start()}}, \mbox{\hyperlink{xmem_8c_source_l00065}{\+\_\+memtest()}}, \mbox{\hyperlink{lcd_8c_source_l00427}{lcd\+\_\+init()}}, and \mbox{\hyperlink{sd_8c_source_l00278}{sd\+\_\+init()}}.

\mbox{\Hypertarget{spi_8h_ae909944aa85ae98323073c628be541aa}\label{spi_8h_ae909944aa85ae98323073c628be541aa}} 
\index{spi.h@{spi.h}!spi\_init@{spi\_init}}
\index{spi\_init@{spi\_init}!spi.h@{spi.h}}
\doxysubsubsection{\texorpdfstring{spi\_init()}{spi\_init()}}
{\footnotesize\ttfamily void spi\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Initialize the SPI interface. 



Definition at line \mbox{\hyperlink{spi_8c_source_l00012}{12}} of file \mbox{\hyperlink{spi_8c_source}{spi.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00013\ \{}
\DoxyCodeLine{00014\ \ \ \ \ SPCR\ =\ (1\ <<\ SPE)\ |\ (1\ <<\ MSTR);}
\DoxyCodeLine{00015\ \ \ \ \ \mbox{\hyperlink{logger_8c_a60bd636ef160c97eb51cf31be5954ba2}{log\_boot\_P}}(LOG\_INIT,\ PSTR(\textcolor{stringliteral}{"{}SPI\ initialized"{}}));}
\DoxyCodeLine{00016\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{logger_8c_source_l00170}{log\+\_\+boot\+\_\+\+P()}}.



Referenced by \mbox{\hyperlink{platform_2avr_2main_8c_source_l00029}{main()}}.

\mbox{\Hypertarget{spi_8h_a419efa4aed1b16b72a80d7a1356780d0}\label{spi_8h_a419efa4aed1b16b72a80d7a1356780d0}} 
\index{spi.h@{spi.h}!spi\_rx\_try@{spi\_rx\_try}}
\index{spi\_rx\_try@{spi\_rx\_try}!spi.h@{spi.h}}
\doxysubsubsection{\texorpdfstring{spi\_rx\_try()}{spi\_rx\_try()}}
{\footnotesize\ttfamily \mbox{\hyperlink{status_8h_a67a0db04d321a74b7e7fcfd3f1a3f70b}{Status}} spi\+\_\+rx\+\_\+try (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} $\ast$}]{out }\end{DoxyParamCaption})}



Try to receive one byte from the SPI interface. 


\begin{DoxyParams}{Parameters}
{\em out} & Output byte \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Status 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{spi_8c_source_l00061}{61}} of file \mbox{\hyperlink{spi_8c_source}{spi.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00062\ \{}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{spi_8c_a2195bbe087062b5ee88ebcdac1e53643}{spi\_xchg\_try}}(0xFF,\ out);}
\DoxyCodeLine{00064\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{spi_8c_source_l00039}{spi\+\_\+xchg\+\_\+try()}}.



Referenced by \mbox{\hyperlink{sd_8c_source_l00178}{\+\_\+sd\+\_\+command\+\_\+try()}}, and \mbox{\hyperlink{sd_8c_source_l00560}{sd\+\_\+read()}}.

\mbox{\Hypertarget{spi_8h_a28af41e6c50d1f29c90a94e1041a8285}\label{spi_8h_a28af41e6c50d1f29c90a94e1041a8285}} 
\index{spi.h@{spi.h}!spi\_tx\_try@{spi\_tx\_try}}
\index{spi\_tx\_try@{spi\_tx\_try}!spi.h@{spi.h}}
\doxysubsubsection{\texorpdfstring{spi\_tx\_try()}{spi\_tx\_try()}}
{\footnotesize\ttfamily \mbox{\hyperlink{status_8h_a67a0db04d321a74b7e7fcfd3f1a3f70b}{Status}} spi\+\_\+tx\+\_\+try (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}}}]{in }\end{DoxyParamCaption})}



Try to send one byte to the SPI interface. 


\begin{DoxyParams}{Parameters}
{\em in} & The byte to send \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Status 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{spi_8c_source_l00055}{55}} of file \mbox{\hyperlink{spi_8c_source}{spi.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00056\ \{}
\DoxyCodeLine{00057\ \ \ \ \ \mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}}\ dummy;}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{spi_8c_a2195bbe087062b5ee88ebcdac1e53643}{spi\_xchg\_try}}(in,\ \&dummy);}
\DoxyCodeLine{00059\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{spi_8c_source_l00039}{spi\+\_\+xchg\+\_\+try()}}.



Referenced by \mbox{\hyperlink{sd_8c_source_l00178}{\+\_\+sd\+\_\+command\+\_\+try()}}, and \mbox{\hyperlink{sd_8c_source_l00560}{sd\+\_\+read()}}.

\mbox{\Hypertarget{spi_8h_aa100766918afcb71b6ba79413f33f9db}\label{spi_8h_aa100766918afcb71b6ba79413f33f9db}} 
\index{spi.h@{spi.h}!spi\_xchg@{spi\_xchg}}
\index{spi\_xchg@{spi\_xchg}!spi.h@{spi.h}}
\doxysubsubsection{\texorpdfstring{spi\_xchg()}{spi\_xchg()}}
{\footnotesize\ttfamily \mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} spi\+\_\+xchg (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}}}]{byte }\end{DoxyParamCaption})}



Send and receive one byte from the SPI interface Panics on timeout. 


\begin{DoxyParams}{Parameters}
{\em byte} & The byte to send \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The byte that was received 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{spi_8c_source_l00024}{24}} of file \mbox{\hyperlink{spi_8c_source}{spi.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00025\ \{}
\DoxyCodeLine{00026\ \ \ \ \ \mbox{\hyperlink{types_8h_ace9d960e74685e2cd84b36132dbbf8aa}{u16}}\ cnt\ =\ 0;}
\DoxyCodeLine{00027\ \ \ \ \ SPDR\ =\ byte;}
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{keywordflow}{while}(!(SPSR\ \&\ (1\ <<\ SPIF)))}
\DoxyCodeLine{00029\ \ \ \ \ \{}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(cnt++\ ==\ 0xFFFF)}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8c_a19a313011d8f478ad9799e546199a9ac}{panic}}(PSTR(\textcolor{stringliteral}{"{}SPI\ timeout"{}}));}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00034\ \ \ \ \ \}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keywordflow}{return}\ SPDR;}
\DoxyCodeLine{00037\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{logger_8c_source_l00183}{panic()}}.



Referenced by \mbox{\hyperlink{lcd_8c_source_l00254}{\+\_\+lcd\+\_\+pixel()}}, \mbox{\hyperlink{lcd_8c_source_l00208}{\+\_\+lcd\+\_\+write\+\_\+data()}}, \mbox{\hyperlink{lcd_8c_source_l00195}{\+\_\+lcd\+\_\+write\+\_\+reg()}}, \mbox{\hyperlink{xmem_8c_source_l00065}{\+\_\+memtest()}}, \mbox{\hyperlink{sd_8c_source_l00142}{\+\_\+sd\+\_\+command()}}, \mbox{\hyperlink{xmem_8c_source_l00156}{\+\_\+xmem\+\_\+read()}}, \mbox{\hyperlink{xmem_8c_source_l00198}{\+\_\+xmem\+\_\+set()}}, \mbox{\hyperlink{xmem_8c_source_l00053}{\+\_\+xmem\+\_\+start()}}, \mbox{\hyperlink{xmem_8c_source_l00177}{\+\_\+xmem\+\_\+write()}}, and \mbox{\hyperlink{sd_8c_source_l00278}{sd\+\_\+init()}}.

\mbox{\Hypertarget{spi_8h_a2195bbe087062b5ee88ebcdac1e53643}\label{spi_8h_a2195bbe087062b5ee88ebcdac1e53643}} 
\index{spi.h@{spi.h}!spi\_xchg\_try@{spi\_xchg\_try}}
\index{spi\_xchg\_try@{spi\_xchg\_try}!spi.h@{spi.h}}
\doxysubsubsection{\texorpdfstring{spi\_xchg\_try()}{spi\_xchg\_try()}}
{\footnotesize\ttfamily \mbox{\hyperlink{status_8h_a67a0db04d321a74b7e7fcfd3f1a3f70b}{Status}} spi\+\_\+xchg\+\_\+try (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}}}]{in,  }\item[{\mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} $\ast$}]{out }\end{DoxyParamCaption})}



Try to send and receive one byte from SPI. 


\begin{DoxyParams}{Parameters}
{\em in} & \mbox{\hyperlink{structInput}{Input}} byte \\
\hline
{\em out} & Output byte \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Status 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{spi_8c_source_l00039}{39}} of file \mbox{\hyperlink{spi_8c_source}{spi.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00040\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \mbox{\hyperlink{types_8h_ace9d960e74685e2cd84b36132dbbf8aa}{u16}}\ cnt\ =\ 0;}
\DoxyCodeLine{00042\ \ \ \ \ SPDR\ =\ in;}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keywordflow}{while}(!(SPSR\ \&\ (1\ <<\ SPIF)))}
\DoxyCodeLine{00044\ \ \ \ \ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(cnt++\ ==\ 0xFFFF)}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_TIMEOUT;}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00049\ \ \ \ \ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \ \ *out\ =\ SPDR;}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordflow}{return}\ STATUS\_OK;}
\DoxyCodeLine{00053\ \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{sd_8c_source_l00560}{sd\+\_\+read()}}, \mbox{\hyperlink{spi_8c_source_l00061}{spi\+\_\+rx\+\_\+try()}}, and \mbox{\hyperlink{spi_8c_source_l00055}{spi\+\_\+tx\+\_\+try()}}.

