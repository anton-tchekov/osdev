\hypertarget{emulator_8h}{}\doxysection{emulator/emulator.h File Reference}
\label{emulator_8h}\index{emulator/emulator.h@{emulator/emulator.h}}


RISC-\/V \mbox{\hyperlink{structEmulator}{Emulator}}.  


{\ttfamily \#include $<$types.\+h$>$}\newline
{\ttfamily \#include $<$event-\/types.\+h$>$}\newline
{\ttfamily \#include $<$keyboard-\/shared.\+h$>$}\newline
{\ttfamily \#include $<$inttypes.\+h$>$}\newline
\doxysubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structEmulator}{Emulator}}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{emulator_8h_a0dbe43a64cbf994bf9189e7767f93342}{kernel\+\_\+init}} (void)
\begin{DoxyCompactList}\small\item\em Initialize emulator kernel and load first process (NOT systemd) \end{DoxyCompactList}\item 
void \mbox{\hyperlink{emulator_8h_a1554b9b4463db6aa6131522c2ab400eb}{os\+\_\+update}} (void)
\begin{DoxyCompactList}\small\item\em Call this function periodically in main loop. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{emulator_8h_acc842b78e848efee5e97116c723b9345}{keyboard\+\_\+event}} (Key key, \mbox{\hyperlink{types_8h_a48d6cd8e4135fb2ff7e7f2dac84089ec}{i32}} chr, Key\+State state)
\begin{DoxyCompactList}\small\item\em Inform the emulator about a key press. \end{DoxyCompactList}\item 
\mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} \mbox{\hyperlink{emulator_8h_ac0a5037d738e40096ed1adb2581cd3d4}{emulator\+\_\+call}} (\mbox{\hyperlink{structEmulator}{Emulator}} $\ast$emu, \mbox{\hyperlink{types_8h_afaa62991928fb9fb18ff0db62a040aba}{u32}} addr, \mbox{\hyperlink{types_8h_afaa62991928fb9fb18ff0db62a040aba}{u32}} $\ast$args, \mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} num, \mbox{\hyperlink{types_8h_afaa62991928fb9fb18ff0db62a040aba}{u32}} sp)
\begin{DoxyCompactList}\small\item\em Call an emulated RISC-\/V function. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
RISC-\/V \mbox{\hyperlink{structEmulator}{Emulator}}. 

\begin{DoxyAuthor}{Author}
Anton Tchekov 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
0.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
17.\+05.\+2023 
\end{DoxyDate}


Definition in file \mbox{\hyperlink{emulator_8h_source}{emulator.\+h}}.



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{emulator_8h_ac0a5037d738e40096ed1adb2581cd3d4}\label{emulator_8h_ac0a5037d738e40096ed1adb2581cd3d4}} 
\index{emulator.h@{emulator.h}!emulator\_call@{emulator\_call}}
\index{emulator\_call@{emulator\_call}!emulator.h@{emulator.h}}
\doxysubsubsection{\texorpdfstring{emulator\_call()}{emulator\_call()}}
{\footnotesize\ttfamily \mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}} emulator\+\_\+call (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structEmulator}{Emulator}} $\ast$}]{emu,  }\item[{\mbox{\hyperlink{types_8h_afaa62991928fb9fb18ff0db62a040aba}{u32}}}]{addr,  }\item[{\mbox{\hyperlink{types_8h_afaa62991928fb9fb18ff0db62a040aba}{u32}} $\ast$}]{args,  }\item[{\mbox{\hyperlink{types_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8}}}]{num,  }\item[{\mbox{\hyperlink{types_8h_afaa62991928fb9fb18ff0db62a040aba}{u32}}}]{sp }\end{DoxyParamCaption})}



Call an emulated RISC-\/V function. 


\begin{DoxyParams}{Parameters}
{\em emu} & Pointer to emulator struct \\
\hline
{\em addr} & Function start address \\
\hline
{\em args} & Function arguments \\
\hline
{\em num} & Number of arguments \\
\hline
{\em sp} & Stack pointer start \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{emulator_8c_source_l01006}{1006}} of file \mbox{\hyperlink{emulator_8c_source}{emulator.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01007\ \{}
\DoxyCodeLine{01008\ \ \ \ \ \mbox{\hyperlink{types_8h_afaa62991928fb9fb18ff0db62a040aba}{u32}}\ i;}
\DoxyCodeLine{01009\ }
\DoxyCodeLine{01010\ \ \ \ \ \textcolor{comment}{/*\ Initialize\ Stack\ Pointer\ at\ end\ of\ memory\ */}}
\DoxyCodeLine{01011\ \ \ \ \ emu-\/>\mbox{\hyperlink{structEmulator_a8c2f51f67d4656f760fd7aa2c986d66e}{Registers}}[2]\ =\ sp\ -\/\ 4;}
\DoxyCodeLine{01012\ \ \ \ \ emu-\/>\mbox{\hyperlink{structEmulator_a67f6a7f8dd88da5f7408c1b82758cb1c}{PC}}\ =\ addr;}
\DoxyCodeLine{01013\ \ \ \ \ \mbox{\hyperlink{string_8c_a6ea826c42748b85ae7c74f1e2ccf7c27}{memcpy}}(\&emu-\/>\mbox{\hyperlink{structEmulator_a8c2f51f67d4656f760fd7aa2c986d66e}{Registers}}[10],\ args,\ num\ *\ \textcolor{keyword}{sizeof}(*emu-\/>\mbox{\hyperlink{structEmulator_a8c2f51f67d4656f760fd7aa2c986d66e}{Registers}}));}
\DoxyCodeLine{01014\ \ \ \ \ i\ =\ 0;}
\DoxyCodeLine{01015\ \ \ \ \ \mbox{\hyperlink{emulator_8c_a4eec34c850d6d037640f3ba3d9988cb2}{\_finished}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01016\ \ \ \ \ \textcolor{keywordflow}{while}(!\mbox{\hyperlink{emulator_8c_a4eec34c850d6d037640f3ba3d9988cb2}{\_finished}})}
\DoxyCodeLine{01017\ \ \ \ \ \{}
\DoxyCodeLine{01018\ \ \ \ \ \ \ \ \ ++i;}
\DoxyCodeLine{01019\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(emulator\_next(emu))}
\DoxyCodeLine{01020\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01021\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{01022\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01023\ \ \ \ \ \}}
\DoxyCodeLine{01024\ }
\DoxyCodeLine{01025\ \ \ \ \ EMU\_LOG(PSTR(\textcolor{stringliteral}{"{}\%"{}}PRIu32\textcolor{stringliteral}{"{}\ Cycles"{}}),\ i);}
\DoxyCodeLine{01026\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01027\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{emulator_8c_source_l00104}{\+\_\+finished}}, \mbox{\hyperlink{string_8c_source_l00094}{memcpy()}}, \mbox{\hyperlink{emulator_8h_source_l00033}{Emulator\+::\+PC}}, and \mbox{\hyperlink{emulator_8h_source_l00036}{Emulator\+::\+Registers}}.



Referenced by \mbox{\hyperlink{emulator_8c_source_l00112}{kernel\+\_\+init()}}, \mbox{\hyperlink{emulator_8c_source_l00127}{keyboard\+\_\+event()}}, and \mbox{\hyperlink{emulator_8c_source_l00118}{os\+\_\+update()}}.

\mbox{\Hypertarget{emulator_8h_a0dbe43a64cbf994bf9189e7767f93342}\label{emulator_8h_a0dbe43a64cbf994bf9189e7767f93342}} 
\index{emulator.h@{emulator.h}!kernel\_init@{kernel\_init}}
\index{kernel\_init@{kernel\_init}!emulator.h@{emulator.h}}
\doxysubsubsection{\texorpdfstring{kernel\_init()}{kernel\_init()}}
{\footnotesize\ttfamily void kernel\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Initialize emulator kernel and load first process (NOT systemd) 



Definition at line \mbox{\hyperlink{emulator_8c_source_l00112}{112}} of file \mbox{\hyperlink{emulator_8c_source}{emulator.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00113\ \{}
\DoxyCodeLine{00114\ \ \ \ \ \mbox{\hyperlink{emulator_8c_a86f3123b3022a4b0ec9c19d860a171d6}{\_memory\_size}}\ =\ \mbox{\hyperlink{avr_2platform_8c_acf57f1ce47563167d4ef978ef1a7ab49}{env\_memory\_size}}();}
\DoxyCodeLine{00115\ \ \ \ \ \mbox{\hyperlink{emulator_8c_ac0a5037d738e40096ed1adb2581cd3d4}{emulator\_call}}(\_emu,\ 0,\ NULL,\ 0,\ \mbox{\hyperlink{emulator_8c_a86f3123b3022a4b0ec9c19d860a171d6}{\_memory\_size}});}
\DoxyCodeLine{00116\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{emulator_8c_source_l00110}{\+\_\+memory\+\_\+size}}, \mbox{\hyperlink{emulator_8c_source_l01006}{emulator\+\_\+call()}}, and \mbox{\hyperlink{avr_2platform_8c_source_l00019}{env\+\_\+memory\+\_\+size()}}.

\mbox{\Hypertarget{emulator_8h_acc842b78e848efee5e97116c723b9345}\label{emulator_8h_acc842b78e848efee5e97116c723b9345}} 
\index{emulator.h@{emulator.h}!keyboard\_event@{keyboard\_event}}
\index{keyboard\_event@{keyboard\_event}!emulator.h@{emulator.h}}
\doxysubsubsection{\texorpdfstring{keyboard\_event()}{keyboard\_event()}}
{\footnotesize\ttfamily void keyboard\+\_\+event (\begin{DoxyParamCaption}\item[{Key}]{key,  }\item[{\mbox{\hyperlink{types_8h_a48d6cd8e4135fb2ff7e7f2dac84089ec}{i32}}}]{chr,  }\item[{Key\+State}]{state }\end{DoxyParamCaption})}



Inform the emulator about a key press. 


\begin{DoxyParams}{Parameters}
{\em key} & The scancode \\
\hline
{\em chr} & The unicode codepoint of the scancode or 0 \\
\hline
{\em state} & The state of the key (pressed, repeat, released) \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{emulator_8c_source_l00127}{127}} of file \mbox{\hyperlink{emulator_8c_source}{emulator.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00128\ \{}
\DoxyCodeLine{00129\ \ \ \ \ \mbox{\hyperlink{types_8h_afaa62991928fb9fb18ff0db62a040aba}{u32}}\ addr\ =\ \_emu-\/>\mbox{\hyperlink{structEmulator_af6349f9e64ef828e37854791fb690c10}{Events}}[\mbox{\hyperlink{event-types_8h_a5667b805d857c6d28f83f6038a0272d3a73957df3a3996d1a32b0fbcdeba044ec}{EVENT\_KEY}}];}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordflow}{if}(addr)}
\DoxyCodeLine{00131\ \ \ \ \ \{}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{types_8h_afaa62991928fb9fb18ff0db62a040aba}{u32}}\ args[]\ =\ \{\ key,\ chr,\ down\ \};}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{emulator_8c_ac0a5037d738e40096ed1adb2581cd3d4}{emulator\_call}}(\_emu,\ addr,\ args,\ \mbox{\hyperlink{util_8h_a5a34c337b71a34ab9a0ecff2d5715d24}{ARRLEN}}(args),\ \mbox{\hyperlink{emulator_8c_a86f3123b3022a4b0ec9c19d860a171d6}{\_memory\_size}});}
\DoxyCodeLine{00134\ \ \ \ \ \}}
\DoxyCodeLine{00135\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{emulator_8c_source_l00110}{\+\_\+memory\+\_\+size}}, \mbox{\hyperlink{util_8h_source_l00013}{ARRLEN}}, \mbox{\hyperlink{emulator_8c_source_l01006}{emulator\+\_\+call()}}, \mbox{\hyperlink{event-types_8h_source_l00020}{EVENT\+\_\+\+KEY}}, and \mbox{\hyperlink{emulator_8h_source_l00030}{Emulator\+::\+Events}}.

\mbox{\Hypertarget{emulator_8h_a1554b9b4463db6aa6131522c2ab400eb}\label{emulator_8h_a1554b9b4463db6aa6131522c2ab400eb}} 
\index{emulator.h@{emulator.h}!os\_update@{os\_update}}
\index{os\_update@{os\_update}!emulator.h@{emulator.h}}
\doxysubsubsection{\texorpdfstring{os\_update()}{os\_update()}}
{\footnotesize\ttfamily void os\+\_\+update (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Call this function periodically in main loop. 



Definition at line \mbox{\hyperlink{emulator_8c_source_l00118}{118}} of file \mbox{\hyperlink{emulator_8c_source}{emulator.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00119\ \{}
\DoxyCodeLine{00120\ \ \ \ \ \mbox{\hyperlink{types_8h_afaa62991928fb9fb18ff0db62a040aba}{u32}}\ addr\ =\ \_emu-\/>\mbox{\hyperlink{structEmulator_af6349f9e64ef828e37854791fb690c10}{Events}}[\mbox{\hyperlink{event-types_8h_a5667b805d857c6d28f83f6038a0272d3af4289a72858bef1b5fb30a0ac1c4d73a}{EVENT\_LOOP}}];}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keywordflow}{if}(addr)}
\DoxyCodeLine{00122\ \ \ \ \ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{emulator_8c_ac0a5037d738e40096ed1adb2581cd3d4}{emulator\_call}}(\_emu,\ addr,\ NULL,\ 0,\ \mbox{\hyperlink{emulator_8c_a86f3123b3022a4b0ec9c19d860a171d6}{\_memory\_size}});}
\DoxyCodeLine{00124\ \ \ \ \ \}}
\DoxyCodeLine{00125\ \}}

\end{DoxyCode}


References \mbox{\hyperlink{emulator_8c_source_l00110}{\+\_\+memory\+\_\+size}}, \mbox{\hyperlink{emulator_8c_source_l01006}{emulator\+\_\+call()}}, \mbox{\hyperlink{event-types_8h_source_l00017}{EVENT\+\_\+\+LOOP}}, and \mbox{\hyperlink{emulator_8h_source_l00030}{Emulator\+::\+Events}}.

